<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="远">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="远">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="远">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/6/">





  <title>远</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">远</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(五)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(五)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(sl)(五)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-04T13:35:35+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm</a></p>
<p>Tutorial<br><a href="http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/</a></p>
<p>D3Overview 必读<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf</a></p>
<p>Sliverlight版本: DynamicDataDisplay.2.0.907</p>
<p>Dynamic Data Display 的Sliverlight版本和Wpf版本中的代码不一样.</p>
<hr>
<h3 id="Markers-Many-markers"><a href="#Markers-Many-markers" class="headerlink" title="Markers: Many markers"></a>Markers: Many markers</h3><p><strong>cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright © 2010-2011 Microsoft Corporation, All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Globalization;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Controls;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Resources;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ManyMarkersSample</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainPage</span> : <span class="title">UserControl</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> y = LoadData();</span><br><span class="line">            <span class="keyword">var</span> x = Enumerable.Range(<span class="number">0</span>, y.Length).Select(p =&gt; (<span class="keyword">double</span>)p).ToArray();</span><br><span class="line"></span><br><span class="line">            markers.MarkersBatchSize = <span class="number">750</span>;</span><br><span class="line">            markers.Plot(x, y);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span>[] <span class="title">LoadData</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            List&lt;<span class="keyword">double</span>&gt; data = <span class="keyword">new</span> List&lt;<span class="keyword">double</span>&gt;(<span class="number">11000</span>);</span><br><span class="line">            StreamResourceInfo sri = Application.GetResourceStream(<span class="keyword">new</span> Uri(<span class="string">"r0001.csv"</span>, UriKind.Relative));</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> sr = <span class="keyword">new</span> StreamReader(sri.Stream))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> s = sr.ReadLine();</span><br><span class="line">                <span class="keyword">while</span> ((s = sr.ReadLine()) != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> d = <span class="keyword">double</span>.Parse(s, CultureInfo.InvariantCulture);</span><br><span class="line">                    data.Add(d);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> data.ToArray();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<blockquote>
<p>This sample renders 11000 markers. Note that markers appear on the screen gradually and quality of zoomed in/zoomed out image also increases gradually. This keeps the sample fully interactive even at the moments when rendering is in progress.</p>
</blockquote>
<p>MarkerGraph的继承关系<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">System.Object</span><br><span class="line">  System.Windows.DependencyObject</span><br><span class="line">    System.Windows.UIElement</span><br><span class="line">      System.Windows.FrameworkElement</span><br><span class="line">        System.Windows.Controls.Panel</span><br><span class="line">          Microsoft.Research.DynamicDataDisplay.PlotBase</span><br><span class="line">            Microsoft.Research.DynamicDataDisplay.MarkerGraph</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.BarGraph</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.CartesianMarkerGraph</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.VerticalIntervalGraph</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="Rendering-optimization"><a href="#Rendering-optimization" class="headerlink" title="Rendering optimization"></a>Rendering optimization</h3><blockquote>
<p>Silverlight has limited rendering performance and plotting more than a few thousands of elements takes signification amount of time which is enough to make application non-interactive. Scientific data sets often contain tens of thousands of data items. To overcome Silverlight limitation MarkerGraph uses <strong>bitmap caching</strong> and <strong>deferred rendering</strong>. You can see how it works in <strong>Many Markers sample</strong> in Interactive SDK. Markers appear on the screen in batches. <strong>Each new batch is rendered when application is idle</strong>, so when user navigated or interacts with UI in other manner markers rendering is suspended. When marker graph needs to be redrawn because of panning or zooming, all batches are instantly replaced with bitmaps which are translated and scaled according to user navigation. After that bitmaps are replaced with real markers batch by batch in application idle moments. You may see it clear when zooming in significantly. Markers became blurred because of bitmap scaling. Later, blurred markers are replaced with re-rendered ones which makes picture look sharp again</p>
</blockquote>
<blockquote>
<p>User can control this process using two properties. <strong>MarkerBatchSize</strong> controls size of marker batch rendered at a single pass. Larger values can cause poor application resposiveness for complex marker templates, small values will result in increase of marker graph update time.</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MarkerGraph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> MarkerBatchSize &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; <span class="comment">// Dep. prop.</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> MaxSnapshotSize &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; <span class="comment">// Dep. prop.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">Plot</span>(<span class="params"><span class="keyword">params</span> <span class="keyword">object</span>[] data</span>)</span>;</span><br><span class="line">    IObservable&lt;RenderCompletion&gt; RenderCompletion;</span><br><span class="line">    …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Marker graph rendering is restarted when data are changed. If data changes occur more frequently than application idle times when marker graph draws itself, most or even all of the data updates may be skipped and not shown. MarkerGraph provides technique to wait until current data is completely displayed. Plot method returns rendering task Id. When this task is either completed or skipped because new data arrives task id is observed on RenderCompletion subject. Using this technique, application can wait for markers complete draw before updating data. See ‘Background rendering’ sample in Interactive SDK</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(六)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(六)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(sl)(六)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-04T13:35:35+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm</a></p>
<p>Tutorial<br><a href="http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/</a></p>
<p>D3Overview 必读<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf</a></p>
<p>Sliverlight版本: DynamicDataDisplay.2.0.907</p>
<p>Dynamic Data Display 的Sliverlight版本和Wpf版本中的代码不一样.</p>
<hr>
<h3 id="Dynamic-Markers-Concurrent-marker-graph"><a href="#Dynamic-Markers-Concurrent-marker-graph" class="headerlink" title="Dynamic Markers: Concurrent marker graph"></a>Dynamic Markers: Concurrent marker graph</h3><p><strong>xaml</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Copyright © 2010-2011 Microsoft Corporation, All Rights Reserved.</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">UserControl</span> <span class="attr">x:Class</span>=<span class="string">"ConcurrentMarkerGraphSample.MainPage"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:x</span>=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:d</span>=<span class="string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mc</span>=<span class="string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:d3</span>=<span class="string">"clr-namespace:Microsoft.Research.DynamicDataDisplay;assembly=DynamicDataDisplay.Silverlight"</span>             </span></span><br><span class="line"><span class="tag">    <span class="attr">mc:Ignorable</span>=<span class="string">"d"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">d:DesignHeight</span>=<span class="string">"300"</span> <span class="attr">d:DesignWidth</span>=<span class="string">"400"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Grid</span> <span class="attr">x:Name</span>=<span class="string">"LayoutRoot"</span> <span class="attr">Background</span>=<span class="string">"White"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">d3:Chart</span> <span class="attr">Name</span>=<span class="string">"plotter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">d3:Chart.Title</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">HorizontalAlignment</span>=<span class="string">"Center"</span> <span class="attr">FontSize</span>=<span class="string">"14"</span> <span class="attr">Margin</span>=<span class="string">"0,5,0,5"</span>&gt;</span>Concurrent marker graph sample<span class="tag">&lt;/<span class="name">TextBlock</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">d3:Chart.Title</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">d3:CircleMarkerGraph</span> <span class="attr">Name</span>=<span class="string">"markers"</span> <span class="attr">Description</span>=<span class="string">"Sine graph"</span> <span class="attr">Color</span>=<span class="string">"Red"</span> <span class="attr">Size</span>=<span class="string">"5"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">d3:Chart</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">UserControl</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright © 2010-2011 Microsoft Corporation, All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Controls;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Media;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConcurrentMarkerGraphSample</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainPage</span> : <span class="title">UserControl</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">bool</span> isUnloaded;</span><br><span class="line">        <span class="keyword">private</span> Thread thread;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> phase;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line"></span><br><span class="line">            markers.MarkersBatchSize = <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Start computation thread when page appears on the screen</span></span><br><span class="line">            Loaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                thread = <span class="keyword">new</span> Thread(ModelRun);</span><br><span class="line">                isUnloaded = <span class="literal">false</span>;</span><br><span class="line">                thread.Start();</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Stop computation thread when page is removed from the screen</span></span><br><span class="line">            Unloaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                isUnloaded = <span class="literal">true</span>;</span><br><span class="line">                thread.Join();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ModelRun</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000</span>;</span><br><span class="line">            <span class="keyword">double</span>[] y = <span class="keyword">new</span> <span class="keyword">double</span>[N];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">                y[i] = Math.Cos(i * Math.PI / <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (!isUnloaded) <span class="comment">// Run until page is on the screen</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Data array is updated</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    y[i] = Math.Cos(i * Math.PI / <span class="number">50</span> + phase);</span><br><span class="line">                &#125;</span><br><span class="line">                phase += <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Render data only if marker graph is not renderind something.</span></span><br><span class="line">                <span class="comment">// This reduce flickering, but not guarantee that each interation of computations</span></span><br><span class="line">                <span class="comment">// will be rendered.</span></span><br><span class="line">                <span class="keyword">if</span> (!markers.IsBusy)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Do not forget to clone changing data before passing to plot</span></span><br><span class="line">                    <span class="keyword">double</span>[] data = (<span class="keyword">double</span>[])y.Clone(); </span><br><span class="line"></span><br><span class="line">                    <span class="comment">// MarkerGraph.Plot method is thread safe.</span></span><br><span class="line">                    <span class="comment">// Note: PlotY, PlotXY and other similar methods of derived </span></span><br><span class="line">                    <span class="comment">// classes are not thread safe and required Dispatcher.BeginInvoke</span></span><br><span class="line">                    markers.Plot(<span class="literal">null</span>, data, Colors.Red, <span class="number">5.0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>In this sample marker graph shows data that are computed in another thread. Important notes:</p>
<ul>
<li>Although IsBusy property is used to reduce flicker, that will not guarantee that each interation will be rendered. See DynamicMarkerGraphSample for such scenario.</li>
<li>MarkerGraph.Plot method is thread safe and can be invoked without using Dispatcher.Beginlnvoke.</li>
<li>However it is unsafe to pass concurrenly updated array to Plot method. In this sample array is cloned before passing to Plot.</li>
</ul>
<p>MarkerGraph的继承关系<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">System.Object</span><br><span class="line">  System.Windows.DependencyObject</span><br><span class="line">    System.Windows.UIElement</span><br><span class="line">      System.Windows.FrameworkElement</span><br><span class="line">        System.Windows.Controls.Panel</span><br><span class="line">          Microsoft.Research.DynamicDataDisplay.PlotBase</span><br><span class="line">            Microsoft.Research.DynamicDataDisplay.MarkerGraph</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.BarGraph</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.CartesianMarkerGraph</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.VerticalIntervalGraph</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(四)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(四)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(sl)(四)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-04T13:29:54+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm</a></p>
<p>Tutorial<br><a href="http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/</a></p>
<p>D3Overview 必读<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf</a></p>
<p>Sliverlight版本: DynamicDataDisplay.2.0.907</p>
<p>Dynamic Data Display 的Sliverlight版本和Wpf版本中的代码不一样.</p>
<hr>
<h3 id="BackgroundBitmapRenderer"><a href="#BackgroundBitmapRenderer" class="headerlink" title="BackgroundBitmapRenderer"></a>BackgroundBitmapRenderer</h3><p>前两个笔记分别讲了Dynamic Heatmap的两种实现方式, 这里看看Heatmap的基类<strong>BackgroundBitmapRenderer</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.ComponentModel;</span><br><span class="line"><span class="keyword">using</span> System.Reactive.Subjects;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Windows;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Controls;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Media;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Media.Imaging;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Research.DynamicDataDisplay</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Base class for renderers, which can prepare its render results in a separate thread.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">BackgroundBitmapRenderer</span> : <span class="title">Plot</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">delegate</span> <span class="keyword">void</span> <span class="title">RenderFunc</span>(<span class="params">RenderResult r, RenderTaskState state</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Image outputImage;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Cartesian coordinates of image currently on the screen.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> DataRect imageCartesianRect;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Size of image currently on the screen.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> Size imageSize;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxTasks;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Queue&lt;<span class="keyword">long</span>&gt; tasks = <span class="keyword">new</span> Queue&lt;<span class="keyword">long</span>&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> List&lt;RenderTaskState&gt; runningTasks;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span> nextID;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Size prevSize = <span class="keyword">new</span> Size(<span class="keyword">double</span>.NaN, <span class="keyword">double</span>.NaN);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> prevScaleX = <span class="keyword">double</span>.NaN;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> prevScaleY = <span class="keyword">double</span>.NaN;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> prevOffsetX = <span class="keyword">double</span>.NaN;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> prevOffsetY = <span class="keyword">double</span>.NaN;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Subject&lt;RenderCompletion&gt; renderCompletion = <span class="keyword">new</span> Subject&lt;RenderCompletion&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Gets event which is occured when render task is finished</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> IObservable&lt;RenderCompletion&gt; RenderCompletion</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.renderCompletion;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Initializes new instance of <span class="doctag">&lt;see cref="T:Microsoft.Research.DynamicDataDisplay.BackgroundBitmapRenderer" /&gt;</span> class, performing all basic preparings for inheriting classes.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="title">BackgroundBitmapRenderer</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.maxTasks = Math.Max(<span class="number">1</span>, Environment.get_ProcessorCount() - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">this</span>.runningTasks = <span class="keyword">new</span> List&lt;RenderTaskState&gt;();</span><br><span class="line">            <span class="keyword">this</span>.outputImage = <span class="keyword">new</span> Image();</span><br><span class="line">            <span class="keyword">this</span>.outputImage.set_Stretch(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">this</span>.outputImage.set_VerticalAlignment(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">this</span>.outputImage.set_HorizontalAlignment(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">base</span>.get_Children().Add(<span class="keyword">this</span>.outputImage);</span><br><span class="line">            <span class="keyword">base</span>.add_Unloaded(<span class="keyword">new</span> RoutedEventHandler(<span class="keyword">this</span>.BackgroundBitmapRendererUnloaded));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">BackgroundBitmapRendererUnloaded</span>(<span class="params"><span class="keyword">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.CancelAll();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Measures the size in layout required for child elements and determines a size for parent. </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="availableSize"&gt;</span>The available size that this element can give to child elements. Infinity can be specified as a value to indicate that the element will size to whatever content is available.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>The size that this element determines it needs during layout, based on its calculations of child element sizes.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Size <span class="title">MeasureOverride</span>(<span class="params">Size availableSize</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            availableSize = <span class="keyword">base</span>.MeasureOverride(availableSize);</span><br><span class="line">            <span class="keyword">this</span>.outputImage.Measure(availableSize);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.prevSize != availableSize || <span class="keyword">this</span>.prevOffsetX != <span class="keyword">this</span>.masterField.OffsetX || <span class="keyword">this</span>.prevOffsetY != <span class="keyword">this</span>.masterField.OffsetY || <span class="keyword">this</span>.prevScaleX != <span class="keyword">this</span>.masterField.ScaleX || <span class="keyword">this</span>.prevScaleY != <span class="keyword">this</span>.masterField.ScaleY)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.prevSize = availableSize;</span><br><span class="line">                <span class="keyword">this</span>.prevOffsetX = <span class="keyword">this</span>.masterField.OffsetX;</span><br><span class="line">                <span class="keyword">this</span>.prevOffsetY = <span class="keyword">this</span>.masterField.OffsetY;</span><br><span class="line">                <span class="keyword">this</span>.prevScaleX = <span class="keyword">this</span>.masterField.ScaleX;</span><br><span class="line">                <span class="keyword">this</span>.prevScaleY = <span class="keyword">this</span>.masterField.ScaleY;</span><br><span class="line">                <span class="keyword">this</span>.CancelAll();</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.imageSize.get_Width() &gt; <span class="number">0.0</span> &amp;&amp; <span class="keyword">this</span>.imageSize.get_Height() &gt; <span class="number">0.0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Point point = <span class="keyword">new</span> Point(<span class="keyword">base</span>.LeftFromX(<span class="keyword">this</span>.imageCartesianRect.XMin), <span class="keyword">base</span>.TopFromY(<span class="keyword">this</span>.imageCartesianRect.YMax));</span><br><span class="line">                    Point point2 = <span class="keyword">new</span> Point(<span class="keyword">base</span>.LeftFromX(<span class="keyword">this</span>.imageCartesianRect.XMax), <span class="keyword">base</span>.TopFromY(<span class="keyword">this</span>.imageCartesianRect.YMin));</span><br><span class="line">                    Canvas.SetLeft(<span class="keyword">this</span>.outputImage, point.get_X());</span><br><span class="line">                    Canvas.SetTop(<span class="keyword">this</span>.outputImage, point.get_Y());</span><br><span class="line">                    UIElement arg_1BA_0 = <span class="keyword">this</span>.outputImage;</span><br><span class="line">                    ScaleTransform scaleTransform = <span class="keyword">new</span> ScaleTransform();</span><br><span class="line">                    scaleTransform.set_ScaleX((point2.get_X() - point.get_X()) / <span class="keyword">this</span>.imageSize.get_Width());</span><br><span class="line">                    scaleTransform.set_ScaleY((point2.get_Y() - point.get_Y()) / <span class="keyword">this</span>.imageSize.get_Height());</span><br><span class="line">                    arg_1BA_0.set_RenderTransform(scaleTransform);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">this</span>.QueueRenderTask();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> availableSize;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EnqueueTask</span>(<span class="params"><span class="keyword">long</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.runningTasks.get_Count() &gt;= <span class="keyword">this</span>.maxTasks)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.tasks.Enqueue(id);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Size screenSize = <span class="keyword">new</span> Size(Math.Abs(<span class="keyword">base</span>.LeftFromX(<span class="keyword">base</span>.ActualPlotRect.XMax) - <span class="keyword">base</span>.LeftFromX(<span class="keyword">base</span>.ActualPlotRect.XMin)), Math.Abs(<span class="keyword">base</span>.TopFromY(<span class="keyword">base</span>.ActualPlotRect.YMax) - <span class="keyword">base</span>.TopFromY(<span class="keyword">base</span>.ActualPlotRect.YMin)));</span><br><span class="line">            RenderTaskState renderTaskState = <span class="keyword">new</span> RenderTaskState(<span class="keyword">base</span>.ActualPlotRect, screenSize);</span><br><span class="line">            renderTaskState.Id = id;</span><br><span class="line">            renderTaskState.Bounds = <span class="keyword">this</span>.ComputeBounds();</span><br><span class="line">            <span class="keyword">this</span>.runningTasks.Add(renderTaskState);</span><br><span class="line">            <span class="keyword">if</span> (!DesignerProperties.get_IsInDesignTool())</span><br><span class="line">            &#123;</span><br><span class="line">                ThreadPool.QueueUserWorkItem(<span class="keyword">delegate</span>(<span class="keyword">object</span> s)</span><br><span class="line">                &#123;</span><br><span class="line">                    RenderResult renderResult = <span class="keyword">this</span>.RenderFrame((RenderTaskState)s);</span><br><span class="line">                    <span class="keyword">base</span>.get_Dispatcher().BeginInvoke(<span class="keyword">new</span> BackgroundBitmapRenderer.RenderFunc(<span class="keyword">this</span>.OnTaskCompleted), <span class="keyword">new</span> <span class="keyword">object</span>[]</span><br><span class="line">                    &#123;</span><br><span class="line">                        renderResult,</span><br><span class="line">                        s</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;, renderTaskState);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            RenderResult r = <span class="keyword">this</span>.RenderFrame(renderTaskState);</span><br><span class="line">            <span class="keyword">this</span>.OnTaskCompleted(r, renderTaskState);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Renders frame and returns it as a render result.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="state"&gt;</span>Render task state for rendering frame.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>Render result of rendered frame.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> RenderResult <span class="title">RenderFrame</span>(<span class="params">RenderTaskState state</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Creates new render task and puts it to queue.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>Async operation ID.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">QueueRenderTask</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">long</span> num;</span><br><span class="line">            <span class="keyword">this</span>.nextID = (num = <span class="keyword">this</span>.nextID) + <span class="number">1L</span>;</span><br><span class="line">            <span class="keyword">long</span> num2 = num;</span><br><span class="line">            <span class="keyword">this</span>.EnqueueTask(num2);</span><br><span class="line">            <span class="keyword">return</span> num2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTaskCompleted</span>(<span class="params">RenderResult r, RenderTaskState state</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (r != <span class="literal">null</span> &amp;&amp; !state.IsCanceled)</span><br><span class="line">            &#123;</span><br><span class="line">                WriteableBitmap writeableBitmap = <span class="keyword">new</span> WriteableBitmap((<span class="keyword">int</span>)r.Output.get_Width(), (<span class="keyword">int</span>)r.Output.get_Height());</span><br><span class="line">                Array.Copy(r.Image, writeableBitmap.get_Pixels(), writeableBitmap.get_PixelHeight() * writeableBitmap.get_PixelWidth());</span><br><span class="line">                writeableBitmap.Invalidate();</span><br><span class="line">                <span class="keyword">this</span>.outputImage.set_Source(writeableBitmap);</span><br><span class="line">                Canvas.SetLeft(<span class="keyword">this</span>.outputImage, r.Output.get_Left());</span><br><span class="line">                Canvas.SetTop(<span class="keyword">this</span>.outputImage, r.Output.get_Top());</span><br><span class="line">                <span class="keyword">this</span>.imageCartesianRect = r.Visible;</span><br><span class="line">                <span class="keyword">this</span>.imageSize = <span class="keyword">new</span> Size(r.Output.get_Width(), r.Output.get_Height());</span><br><span class="line">                <span class="keyword">this</span>.outputImage.set_RenderTransform(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.RaiseTaskCompletion(state.Id);</span><br><span class="line">            <span class="keyword">this</span>.runningTasks.Remove(state);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">this</span>.tasks.get_Count() &gt; <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">long</span> id = <span class="keyword">this</span>.tasks.Dequeue();</span><br><span class="line">                <span class="keyword">this</span>.RaiseTaskCompletion(id);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.tasks.get_Count() &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.runningTasks.get_Count() &lt; <span class="keyword">this</span>.maxTasks)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.EnqueueTask(<span class="keyword">this</span>.tasks.Dequeue());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">base</span>.InvalidateMeasure();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Cancel all tasks, which are in quere.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CancelAll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">using</span> (List&lt;RenderTaskState&gt;.Enumerator enumerator = <span class="keyword">this</span>.runningTasks.GetEnumerator())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">while</span> (enumerator.MoveNext())</span><br><span class="line">                &#123;</span><br><span class="line">                    RenderTaskState current = enumerator.get_Current();</span><br><span class="line">                    current.Stop();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Raises RenderCompletion event when task with the specified id is finished</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="id"&gt;</span>ID of finished task<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">RaiseTaskCompletion</span>(<span class="params"><span class="keyword">long</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.renderCompletion.OnNext(<span class="keyword">new</span> RenderCompletion</span><br><span class="line">            &#123;</span><br><span class="line">                TaskId = id</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>关键在于理解OnTaskCompleted中的这一段<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="keyword">this</span>.tasks.get_Count() &gt; <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">long</span> id = <span class="keyword">this</span>.tasks.Dequeue();</span><br><span class="line">    <span class="keyword">this</span>.RaiseTaskCompletion(id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.tasks.get_Count() &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">this</span>.runningTasks.get_Count() &lt; <span class="keyword">this</span>.maxTasks)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.EnqueueTask(<span class="keyword">this</span>.tasks.Dequeue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>完成当前task后, </p>
<ol>
<li>将tasks中的其他taskId去掉, 只剩下1个;//while循环</li>
<li>将剩下的1个taskId作为参数, 调用EnqueueTask;//if语句</li>
</ol>
<p>剩1个, 双核的话, maxTasks为1<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.maxTasks = Math.Max(<span class="number">1</span>, Environment.get_ProcessorCount() - <span class="number">1</span>);</span><br></pre></td></tr></table></figure></p>
<p>举个例子: tasks中有taskId: 1, 2, 3, 4<br>1当前完成, tasks去掉2和3, 剩下4, 然后将4作为参数, 调用EnqueueTask</p>
<p>1和4是调用EnqueueTask, 真正绘制的; 2和3虽然调用了Plot方法, 但没有绘制</p>
<p>这就是work thread和render thread没有同步的结果. 1还没绘制好, 2,3,4的数据已经来了.<br>这是「DynamicDataDisplay(sl)笔记(二)」中会出现的状况.</p>
<p>一个解决的方式是work thread等到render thread绘制完之后, 才准备下一个render的数据; 即等1绘制完之后, 才让work thread<br>准备2的数据.也就是说work thread和render thread之间要进行消息通信. 信息通信依靠AutoResetEvent.</p>
<p>问题来了, work thread怎么知道render thread绘制完了. 看Plot的代码, Plot只是返回了一个taskId; 多次调用Plot会产生<br>多个taskId, 这些taskId构成一个序列. </p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">Plot</span>(<span class="params"><span class="keyword">double</span>[,] data, <span class="keyword">double</span>[] x, <span class="keyword">double</span>[] y, <span class="keyword">double</span> missingValue</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HeatmapGraph.VerifyDimensions(data, x, y);</span><br><span class="line">    <span class="keyword">lock</span> (<span class="keyword">this</span>.locker)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.xArr = x;</span><br><span class="line">        <span class="keyword">this</span>.yArr = y;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.missingValue = missingValue;</span><br><span class="line">        <span class="keyword">this</span>.dataVersion += <span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.InvalidateBounds();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">base</span>.QueueRenderTask();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作者这里用reactive extension的Subject(Subject既是IObservable也是IObserver)对序列进行过滤<br>当完成的RenderCompletion中的taskId 等于 Plot返回的id, 表示当前Plot绘制完成, 转而通知work thread继续生成新的数据<br>然后进行下一次Plot; 这样tasks中不会累积1,2,3,4</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PlotData</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// HeatmapGraph objects prepare images to be drawn in a background thread. </span></span><br><span class="line">    <span class="comment">// The Plot method cancels current incomplete images before starting a new one. </span></span><br><span class="line">    <span class="comment">// This increases responsiveness of the UI but may result in loss of certain </span></span><br><span class="line">    <span class="comment">// or even all of the frames.</span></span><br><span class="line">    <span class="comment">// The following code shows how to wait until a certain data is actually drawn.</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">long</span> id = heatmap.Plot(f, x, y); <span class="comment">// receive a unique operation identifier</span></span><br><span class="line">    heatmap.RenderCompletion <span class="comment">// an observable of completed and cancelled operations</span></span><br><span class="line">        .Where(rc =&gt; rc.TaskId == id) <span class="comment">// filter out an operation with the known id</span></span><br><span class="line">        .Subscribe(dummy =&gt; &#123; renderComplete.Set(); &#125;); <span class="comment">// signal when the id is observed</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前一种方式和后一种方式都值得学习</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(三)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(三)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(sl)(三)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-04T11:28:15+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm</a></p>
<p>Tutorial<br><a href="http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/</a></p>
<p>D3Overview 必读<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf</a></p>
<p>Sliverlight版本: DynamicDataDisplay.2.0.907</p>
<p>Dynamic Data Display 的Sliverlight版本和Wpf版本中的代码不一样.</p>
<hr>
<h3 id="Heatmap-background-computations"><a href="#Heatmap-background-computations" class="headerlink" title="Heatmap: background computations"></a>Heatmap: background computations</h3><p><strong>xaml</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Copyright © <span class="number">2010</span><span class="number">-2011</span> Microsoft Corporation, All Rights Reserved.</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;UserControl x:Class=<span class="string">"DynamicHeatmapSample.MainPage"</span></span><br><span class="line">    xmlns=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span><br><span class="line">    xmlns:x=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span><br><span class="line">    xmlns:d=<span class="string">"http://schemas.microsoft.com/expression/blend/2008"</span></span><br><span class="line">    xmlns:mc=<span class="string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span><br><span class="line">    mc:Ignorable=<span class="string">"d"</span></span><br><span class="line">    d:DesignHeight=<span class="string">"300"</span> d:DesignWidth=<span class="string">"400"</span></span><br><span class="line">    xmlns:d3=<span class="string">"clr-namespace:Microsoft.Research.DynamicDataDisplay;assembly=DynamicDataDisplay.Silverlight"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Grid x:Name=<span class="string">"LayoutRoot"</span> Background=<span class="string">"White"</span>&gt;</span><br><span class="line">        &lt;d3:Chart&gt;</span><br><span class="line">            &lt;d3:Chart.Title&gt;</span><br><span class="line">                &lt;TextBlock FontSize=<span class="string">"14"</span> Margin=<span class="string">"0,5,0,5"</span>&gt;Background computations sample&lt;/TextBlock&gt;</span><br><span class="line">            &lt;/d3:Chart.Title&gt;</span><br><span class="line">            &lt;d3:HeatmapGraph x:Name=<span class="string">"heatmap"</span> Palette=<span class="string">"Yellow,Blue,Orange"</span>/&gt;</span><br><span class="line">        &lt;/d3:Chart&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line"></span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright © 2010-2011 Microsoft Corporation, All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Reactive.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Controls;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DynamicHeatmapSample</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainPage</span> : <span class="title">UserControl</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">bool</span> isUnloaded = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">private</span> AutoResetEvent renderComplete = <span class="keyword">new</span> AutoResetEvent(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">private</span> Thread thread;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> phase = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span>[] x = <span class="keyword">new</span> <span class="keyword">double</span>[N + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">double</span>[] y = <span class="keyword">new</span> <span class="keyword">double</span>[M + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">double</span>[,] f = <span class="keyword">new</span> <span class="keyword">double</span>[N, M];</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Start computation thread when Page appears on the screen</span></span><br><span class="line">            Loaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                thread = <span class="keyword">new</span> Thread(ModelRun);</span><br><span class="line">                isUnloaded = <span class="literal">false</span>;</span><br><span class="line">                thread.Start();</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Stop computation thread when Page is removed from the screen</span></span><br><span class="line">            Unloaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                isUnloaded = <span class="literal">true</span>;</span><br><span class="line">                renderComplete.Set();</span><br><span class="line">                thread.Join();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ModelRun</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// Coordinate grid is constant</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++)</span><br><span class="line">                x[i] = -Math.PI + <span class="number">2</span> * i * Math.PI / N;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= M; j++)</span><br><span class="line">                y[j] = -Math.PI / <span class="number">2</span> + j * Math.PI / M;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (!isUnloaded) <span class="comment">// Run until page is on the screen</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Data array is updated</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++)</span><br><span class="line">                        f[i, j] = Math.Sqrt(x[i] * x[i] + y[j] * y[j]) * Math.Abs(Math.Cos(x[i] * x[i] + y[j] * y[j] + phase));</span><br><span class="line">                phase += <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Uncomment next line to simulate delay in computations</span></span><br><span class="line">                <span class="comment">// Thread.Sleep(1000);</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Plot the computed array.</span></span><br><span class="line">                <span class="comment">// The Plot method must be called from the UI dispatcher thread. </span></span><br><span class="line">                <span class="comment">// Unlike Tutoral3 sample here we wait for each frame to be rendered.</span></span><br><span class="line">                <span class="keyword">if</span> (!isUnloaded)</span><br><span class="line">                &#123;</span><br><span class="line">                    renderComplete.Reset();</span><br><span class="line">                    Dispatcher.BeginInvoke(PlotData);</span><br><span class="line">                    renderComplete.WaitOne();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PlotData</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// HeatmapGraph objects prepare images to be drawn in a background thread. </span></span><br><span class="line">            <span class="comment">// The Plot method cancels current incomplete images before starting a new one. </span></span><br><span class="line">            <span class="comment">// This increases responsiveness of the UI but may result in loss of certain </span></span><br><span class="line">            <span class="comment">// or even all of the frames.</span></span><br><span class="line">            <span class="comment">// The following code shows how to wait until a certain data is actually drawn.</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">long</span> id = heatmap.Plot(f, x, y); <span class="comment">// receive a unique operation identifier</span></span><br><span class="line">            heatmap.RenderCompletion <span class="comment">// an observable of completed and cancelled operations</span></span><br><span class="line">                .Where(rc =&gt; rc.TaskId == id) <span class="comment">// filter out an operation with the known id</span></span><br><span class="line">                .Subscribe(dummy =&gt; &#123; renderComplete.Set(); &#125;); <span class="comment">// signal when the id is observed</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<blockquote>
<p>This sample shows how to plot data that are computed in separated thread. Unlike Tutorial 3, in this sample  computational thread waits for each frame to be rendered. This is achieved by observing RenderCompletion event and signaling when render operation with specific ID is completed (see ‘PlotData’ method for details).</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(二)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(二)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(sl)(二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-04T09:56:40+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm</a></p>
<p>Tutorial<br><a href="http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/</a></p>
<p>D3Overview 必读<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf</a></p>
<p>Sliverlight版本: DynamicDataDisplay.2.0.907</p>
<p>Dynamic Data Display 的Sliverlight版本和Wpf版本中的代码不一样.</p>
<hr>
<h3 id="Tutorial-3-Drawing-dynamic-heatmap"><a href="#Tutorial-3-Drawing-dynamic-heatmap" class="headerlink" title="Tutorial 3: Drawing dynamic heatmap"></a>Tutorial 3: Drawing dynamic heatmap</h3><p><strong>xaml</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Copyright © <span class="number">2010</span><span class="number">-2011</span> Microsoft Corporation, All Rights Reserved.</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;UserControl x:Class=<span class="string">"Tutorial3.MainPage"</span></span><br><span class="line">    xmlns=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span><br><span class="line">    xmlns:x=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span><br><span class="line">    xmlns:d=<span class="string">"http://schemas.microsoft.com/expression/blend/2008"</span></span><br><span class="line">    xmlns:mc=<span class="string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span><br><span class="line">    xmlns:d3=<span class="string">"clr-namespace:Microsoft.Research.DynamicDataDisplay;assembly=DynamicDataDisplay.Silverlight"</span></span><br><span class="line">    mc:Ignorable=<span class="string">"d"</span></span><br><span class="line">    d:DesignHeight=<span class="string">"300"</span> d:DesignWidth=<span class="string">"400"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Grid x:Name=<span class="string">"LayoutRoot"</span> Background=<span class="string">"White"</span>&gt;</span><br><span class="line">        &lt;d3:Chart&gt;</span><br><span class="line">            &lt;d3:Chart.Title&gt;</span><br><span class="line">                &lt;TextBlock HorizontalAlignment=<span class="string">"Center"</span> FontSize=<span class="string">"14"</span> Margin=<span class="string">"0,5,0,5"</span>&gt;Tutorial <span class="number">3</span>: Dynamic heatmap&lt;/TextBlock&gt;</span><br><span class="line">            &lt;/d3:Chart.Title&gt;</span><br><span class="line">            &lt;d3:HeatmapGraph Name=<span class="string">"heatmap"</span> Palette=<span class="string">"Blue,#00FF00,Red"</span>/&gt;</span><br><span class="line">        &lt;/d3:Chart&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright © 2010-2011 Microsoft Corporation, All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Controls;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Tutorial3</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainPage</span> : <span class="title">UserControl</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">bool</span> isUnloaded = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">private</span> Thread thread;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">double</span> phase = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Start computation thread when page appears on the screen</span></span><br><span class="line">            Loaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                thread = <span class="keyword">new</span> Thread(ModelRun);</span><br><span class="line">                isUnloaded = <span class="literal">false</span>;</span><br><span class="line">                thread.Start();</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Stop computation thread when page is removed from the screen</span></span><br><span class="line">            Unloaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                isUnloaded = <span class="literal">true</span>;</span><br><span class="line">                thread.Join();</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Performs computations. Runs until isUnloaded became true.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ModelRun</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000</span>;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">int</span> M = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1D arrays for grid </span></span><br><span class="line">            <span class="keyword">double</span>[] x = <span class="keyword">new</span> <span class="keyword">double</span>[N + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">double</span>[] y = <span class="keyword">new</span> <span class="keyword">double</span>[M + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Size of data array here is one less than size of the grid.</span></span><br><span class="line">            <span class="comment">// HeatmapGraph will render in bitmap mode, when grid of size (N+1) x (M+1) </span></span><br><span class="line">            <span class="comment">// defines N x M rectangular cells filled with solid color according to </span></span><br><span class="line">            <span class="comment">// corresponding element of data array.</span></span><br><span class="line">            <span class="keyword">double</span>[,] f = <span class="keyword">new</span> <span class="keyword">double</span>[N, M]; </span><br><span class="line"></span><br><span class="line">            <span class="comment">// Coordinate grid is constant and it is initialized once</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= N; i++)</span><br><span class="line">                x[i] = -Math.PI + <span class="number">2</span> * i * Math.PI / N;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= M; j++)</span><br><span class="line">                y[j] = -Math.PI / <span class="number">2</span> + j * Math.PI / M;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (!isUnloaded) <span class="comment">// Run until page is on the screen</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Compute next iteration and store it in data array</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; M; j++)</span><br><span class="line">                        f[i, j] = Math.Sqrt(x[i] * x[i] + y[j] * y[j])</span><br><span class="line">                                  * Math.Abs(Math.Cos(x[i] * x[i] + y[j] * y[j] + phase));</span><br><span class="line">                phase += <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Uncomment next line to simulate delay in computations</span></span><br><span class="line">                <span class="comment">// Thread.Sleep(1000);</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Plot the computed array. </span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                <span class="comment">// The Plot method must be called from the UI dispatcher thread. </span></span><br><span class="line">                <span class="comment">// We pass a clone of the data array to the Plot method to prevent </span></span><br><span class="line">                <span class="comment">// concurrent modification of the plotted data. </span></span><br><span class="line">                Dispatcher.BeginInvoke(</span><br><span class="line">                    <span class="keyword">new</span> Action&lt;<span class="keyword">object</span>&gt;(data =&gt; heatmap.Plot((<span class="keyword">double</span>[,])data, x, y)), f.Clone());</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>很常规的做法: 起一个线程用来做计算, 但Plot的调用必须在UI线程中, 因为heatmap是UI线程创建的; 注释已经写的比较明白了, 但在<strong>Discription</strong>中提到如下:</p>
<blockquote>
<p>Please note that you need to use BeginInvoke to access UI elements from other threads and you need to clone all arrays that are changed in computation thread<br>here Plot method acts as asyncronous. It returns immediately and picture appears on the screen when it is completed. More complex approach when computation thread is waiting for each frame to be shown on the screen is present in code of tutorial</p>
</blockquote>
<p><strong>HeatmapGraph</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">System.Object</span><br><span class="line">  System.Windows.DependencyObject</span><br><span class="line">    System.Windows.UIElement</span><br><span class="line">      System.Windows.FrameworkElement</span><br><span class="line">        System.Windows.Controls.Panel</span><br><span class="line">          Microsoft.Research.DynamicDataDisplay.PlotBase</span><br><span class="line">            Microsoft.Research.DynamicDataDisplay.Plot</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.BackgroundBitmapRenderer</span><br><span class="line">                Microsoft.Research.DynamicDataDisplay.HeatmapGraph</span><br></pre></td></tr></table></figure></p>
<p>Plot方法是异步的, 看看Plot<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">Plot</span>(<span class="params"><span class="keyword">double</span>[,] data, <span class="keyword">double</span>[] x, <span class="keyword">double</span>[] y, <span class="keyword">double</span> missingValue</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    HeatmapGraph.VerifyDimensions(data, x, y);</span><br><span class="line">    <span class="keyword">lock</span> (<span class="keyword">this</span>.locker)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.xArr = x;</span><br><span class="line">        <span class="keyword">this</span>.yArr = y;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.missingValue = missingValue;</span><br><span class="line">        <span class="keyword">this</span>.dataVersion += <span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.InvalidateBounds();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">base</span>.QueueRenderTask();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>base是指BackgroundBitmapRenderer<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Base class for renderers, which can prepare its render results in a separate thread.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">BackgroundBitmapRenderer</span> : <span class="title">Plot</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Microsoft.Research.DynamicDataDisplay.BackgroundBitmapRenderer</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Creates new render task and puts it to queue.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>Async operation ID.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">QueueRenderTask</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">long</span> num;</span><br><span class="line">        <span class="keyword">this</span>.nextID = (num = <span class="keyword">this</span>.nextID) + <span class="number">1L</span>;</span><br><span class="line">        <span class="keyword">long</span> num2 = num;</span><br><span class="line">        <span class="keyword">this</span>.EnqueueTask(num2);</span><br><span class="line">        <span class="keyword">return</span> num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>关于BackgroundBitmapRenderer需要单独写一篇, 先暂且到这</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(一)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/04/2D Visualization笔记(X3) DynamicDataDisplay(sl)(一)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(sl)(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-04T09:17:21+08:00">
                2017-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>官方<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/dynamicdatadisplay.htm</a></p>
<p>Tutorial<br><a href="http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/projects/ddd/d3isdk/</a></p>
<p>D3Overview 必读<br><a href="http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf" target="_blank" rel="noopener">http://research.microsoft.com/en-us/um/cambridge/groups/science/tools/d3/D3Overview.pdf</a></p>
<p>Sliverlight版本: DynamicDataDisplay.2.0.907</p>
<p>Dynamic Data Display 的Sliverlight版本和Wpf版本中的代码不一样.</p>
<hr>
<h3 id="Tutorial-1-Line-graph"><a href="#Tutorial-1-Line-graph" class="headerlink" title="Tutorial 1: Line graph"></a>Tutorial 1: Line graph</h3><p><strong>xaml</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Copyright © <span class="number">2010</span><span class="number">-2011</span> Microsoft Corporation, All Rights Reserved.</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;UserControl x:Class=<span class="string">"Tutorial1.MainPage"</span></span><br><span class="line">    xmlns=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span><br><span class="line">    xmlns:x=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span><br><span class="line">    xmlns:d=<span class="string">"http://schemas.microsoft.com/expression/blend/2008"</span></span><br><span class="line">    xmlns:mc=<span class="string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span><br><span class="line">    xmlns:d3=<span class="string">"clr-namespace:Microsoft.Research.DynamicDataDisplay;assembly=DynamicDataDisplay.Silverlight"</span></span><br><span class="line">    mc:Ignorable=<span class="string">"d"</span></span><br><span class="line">    d:DesignHeight=<span class="string">"300"</span> d:DesignWidth=<span class="string">"400"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Grid x:Name=<span class="string">"LayoutRoot"</span> Background=<span class="string">"White"</span>&gt;        </span><br><span class="line">        &lt;!-- D3 markup starts here--&gt;</span><br><span class="line">        &lt;d3:Chart BottomTitle=<span class="string">"Sinc argument"</span> LeftTitle=<span class="string">"Sinc value"</span>&gt;</span><br><span class="line">            &lt;d3:Chart.Title&gt;</span><br><span class="line">                &lt;TextBlock HorizontalAlignment=<span class="string">"Center"</span> FontSize=<span class="string">"14"</span> Margin=<span class="string">"0,5,0,5"</span>&gt;Tutorial <span class="number">1</span>: Line graph&lt;/TextBlock&gt;</span><br><span class="line">            &lt;/d3:Chart.Title&gt;</span><br><span class="line">            &lt;d3:LineGraph x:Name=<span class="string">"linegraph"</span> Description=<span class="string">"Sinc graph"</span> Stroke=<span class="string">"Blue"</span> StrokeThickness=<span class="string">"3"</span>/&gt;</span><br><span class="line">        &lt;/d3:Chart&gt;        </span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/UserControl&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>cs</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright © 2010-2011 Microsoft Corporation, All Rights Reserved.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Windows.Controls;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Tutorial1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainPage</span> : <span class="title">UserControl</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MainPage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Compute x array of 1001 points from 0 to 100 with 0.1 step</span></span><br><span class="line">            <span class="keyword">var</span> x = Enumerable.Range(<span class="number">0</span>, <span class="number">1001</span>).Select(i =&gt; i / <span class="number">10.0</span>).ToArray();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Compute y array as sin(x)/x function defined on x grid</span></span><br><span class="line">            <span class="keyword">var</span> y = x.Select(v =&gt; Math.Abs(v) &lt; <span class="number">1e-10</span> ? <span class="number">1</span> : Math.Sin(v) / v).ToArray();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Plot data </span></span><br><span class="line">            linegraph.Plot(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>Chart</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">System.Object</span><br><span class="line">  System.Windows.DependencyObject</span><br><span class="line">    System.Windows.UIElement</span><br><span class="line">      System.Windows.FrameworkElement</span><br><span class="line">        System.Windows.Controls.Control</span><br><span class="line">          System.Windows.Controls.ContentControl</span><br><span class="line">            Microsoft.Research.DynamicDataDisplay.Chart</span><br></pre></td></tr></table></figure></p>
<p><strong>LineGraph</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">System..Object</span><br><span class="line">  System.Windows.DependencyObject</span><br><span class="line">    System.Windows.UIElement</span><br><span class="line">      System.Windows.FrameworkElement</span><br><span class="line">        System.Windows.Controls.Panel</span><br><span class="line">          Microsoft.Research.DynamicDataDisplay.PlotBase</span><br><span class="line">            Microsoft.Research.DynamicDataDisplay.Plot</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.LineGraph</span><br></pre></td></tr></table></figure></p>
<p>Line graph uses internally Polyline Silverlight element with attached Plot.Points property. Line graph adds Plot methods, Description<br>property and legend support to existing Polyline functionality; 是在Polyline(SL内置)的基础上添加了Plot方法, Description(描述)和legend(图例)<br>——D3Overview<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LineGraph</span> : <span class="title">Plot</span> </span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">private</span> Polyline polyline;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Identifies <span class="doctag">&lt;see cref="P:Microsoft.Research.DynamicDataDisplay.LineGraph.Points" /&gt;</span> dependecy property</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">new</span> <span class="keyword">static</span> <span class="keyword">readonly</span> DependencyProperty PointsProperty = DependencyProperty.Register(<span class="string">"Points"</span>, <span class="keyword">typeof</span>(PointCollection), <span class="keyword">typeof</span>(LineGraph), <span class="keyword">new</span> PropertyMetadata(<span class="keyword">new</span> PointCollection(), <span class="keyword">delegate</span>(DependencyObject o, DependencyPropertyChangedEventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        LineGraph lineGraph = (LineGraph)o;</span><br><span class="line">        <span class="keyword">if</span> (lineGraph != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Microsoft.Research.DynamicDataDisplay.Plot.SetPoints(lineGraph.polyline, (PointCollection)e.get_NewValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Plot</span>(<span class="params">IEnumerable x, IEnumerable y</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        ...</span><br><span class="line">        PointCollection pointCollection = <span class="keyword">new</span> PointCollection();</span><br><span class="line">        IEnumerator enumerator = x.GetEnumerator();</span><br><span class="line">        IEnumerator enumerator2 = y.GetEnumerator();</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">this</span>.Points = pointCollection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Gets or sets line graph points.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> PointCollection Points</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> (PointCollection)<span class="keyword">base</span>.GetValue(LineGraph.PointsProperty);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.SetValue(LineGraph.PointsProperty, <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="变换"><a href="#变换" class="headerlink" title="变换"></a>变换</h3><p>与wpf版本中类似<br>Each plot requires a <strong>coordinate transform</strong>, actually a composition of <strong>data transform</strong> and <strong>plot transform</strong>.</p>
<p><strong>Data transform</strong> for a given data element d computes its vertical or horizontal coordinate x or y on plot plane</p>
<p><strong>Plot transform</strong> is a transform from plot coordinates to screen coordinates. Plot transform is<br>always a composition of Translate and Scale transforms, so it is independent along each axis and defined by<br>four numbers xscale, yscale, xoffset, yoffset</p>
<p><strong>PlotBase</strong>是Plot最重要的类<br>PlotBase is a Silverlight panel that facilitates several tasks:  </p>
<ul>
<li>Coordinate transformation between screen and user data</li>
<li>AutoFit mode support</li>
<li>Management of plot composition and coordinate transforms synchronization</li>
</ul>
<hr>
<h3 id="Plot-Figure和Chart"><a href="#Plot-Figure和Chart" class="headerlink" title="Plot, Figure和Chart"></a>Plot, Figure和Chart</h3><ul>
<li>LineGraph是Plot</li>
<li>Figure class is a panel  derived from PlotBase and provides special layout options that are often found in<br>charts. It provides attached property Placement that allows to place child elements in center, left, top, right<br>and bottom slots</li>
<li>Chart element is a prepackaged(预包装) figure with axis, grid lines, legend and title</li>
</ul>
<p>Figure 更灵活, Chart更方便</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Grid</span> <span class="attr">x:Name</span>=<span class="string">"LayoutRoot"</span> <span class="attr">Background</span>=<span class="string">"White"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">d3:Figure</span> <span class="attr">PlotOriginY</span>=<span class="string">"-1.5"</span> <span class="attr">PlotHeight</span>=<span class="string">"3"</span> <span class="attr">PlotOriginX</span>=<span class="string">"&#123;Binding Value, ElementName=slider, Mode=TwoWay&#125;"</span> <span class="attr">PlotWidth</span>=<span class="string">"30"</span> <span class="attr">IsAutoFitEnabled</span>=<span class="string">"False"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextBlock</span> <span class="attr">d3:Figure.Placement</span>=<span class="string">"Top"</span> <span class="attr">Text</span>=<span class="string">"Axis with ScrollBar sample"</span> <span class="attr">TextAlignment</span>=<span class="string">"Center"</span> <span class="attr">FontSize</span>=<span class="string">"14"</span> <span class="attr">Margin</span>=<span class="string">"5"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">d3:LineGraph</span> <span class="attr">x:Name</span>=<span class="string">"cos"</span> <span class="attr">Grid.Row</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Slider</span> <span class="attr">x:Name</span>=<span class="string">"slider"</span> <span class="attr">Maximum</span>=<span class="string">"100"</span> <span class="attr">d3:Figure.Placement</span>=<span class="string">"Bottom"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">d3:PlotAxis</span> <span class="attr">d3:Figure.Placement</span>=<span class="string">"Bottom"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">d3:Figure</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/03/2D Visualization笔记(X3) DynamicDataDisplay(wpf)(一)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/03/2D Visualization笔记(X3) DynamicDataDisplay(wpf)(一)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(wpf)(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-03T16:03:57+08:00">
                2017-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hello World Demo 分析</p>
<h4 id="MainWindow-xaml"><a href="#MainWindow-xaml" class="headerlink" title="MainWindow.xaml"></a>MainWindow.xaml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Window</span> <span class="attr">x:Class</span>=<span class="string">"Simplest.MainWindow"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:x</span>=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:d3</span>=<span class="string">"http://research.microsoft.com/DynamicDataDisplay/1.0"</span>    </span></span><br><span class="line"><span class="tag">    <span class="attr">Title</span>=<span class="string">"Simplest plot sample"</span> <span class="attr">Height</span>=<span class="string">"243"</span> <span class="attr">Width</span>=<span class="string">"416"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">d3:ChartPlotter</span> <span class="attr">Name</span>=<span class="string">"plotter"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">d3:Header</span> <span class="attr">TextBlock.FontSize</span>=<span class="string">"20"</span>&gt;</span></span><br><span class="line">            Very simple chart</span><br><span class="line">        <span class="tag">&lt;/<span class="name">d3:Header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">d3:VerticalAxisTitle</span>&gt;</span>Sine value<span class="tag">&lt;/<span class="name">d3:VerticalAxisTitle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">d3:HorizontalAxisTitle</span>&gt;</span>Sine argument<span class="tag">&lt;/<span class="name">d3:HorizontalAxisTitle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">d3:ChartPlotter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Window</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="MainWindow-xaml-cs"><a href="#MainWindow-xaml-cs" class="headerlink" title="MainWindow.xaml.cs"></a>MainWindow.xaml.cs</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Simplest</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Interaction logic for simplest plot application<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">MainWindow</span> : <span class="title">Window</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MainWindow</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			InitializeComponent();</span><br><span class="line"></span><br><span class="line">			Loaded += <span class="keyword">new</span> RoutedEventHandler(MainWindow_Loaded);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">void</span> <span class="title">MainWindow_Loaded</span>(<span class="params"><span class="keyword">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="comment">// Prepare data in arrays</span></span><br><span class="line">			<span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000</span>;</span><br><span class="line">			<span class="keyword">double</span>[] x = <span class="keyword">new</span> <span class="keyword">double</span>[N];</span><br><span class="line">			<span class="keyword">double</span>[] y = <span class="keyword">new</span> <span class="keyword">double</span>[N];</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				x[i] = i * <span class="number">0.1</span>;</span><br><span class="line">				y[i] = Math.Sin(x[i]);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Create data sources:</span></span><br><span class="line">			<span class="keyword">var</span> xDataSource = x.AsXDataSource();</span><br><span class="line">			<span class="keyword">var</span> yDataSource = y.AsYDataSource();</span><br><span class="line"></span><br><span class="line">			CompositeDataSource compositeDataSource = xDataSource.Join(yDataSource);</span><br><span class="line">			<span class="comment">// adding graph to plotter</span></span><br><span class="line">			plotter.AddLineGraph(compositeDataSource,</span><br><span class="line">				Colors.Goldenrod,</span><br><span class="line">				<span class="number">3</span>,</span><br><span class="line">				<span class="string">"zmapleaf"</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Force evertyhing plotted to be visible</span></span><br><span class="line">			plotter.FitToView();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Plot中插入图表<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LineGraph <span class="title">AddLineGraph</span>(<span class="params"><span class="keyword">this</span> Plotter2D plotter, IPointDataSource pointSource, Pen linePen, Description description</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LineGraph graph = <span class="keyword">new</span> LineGraph</span><br><span class="line">	&#123;</span><br><span class="line">		DataSource = pointSource,</span><br><span class="line">		LinePen = linePen</span><br><span class="line">	&#125;;</span><br><span class="line">	graph.Filters.Add(<span class="keyword">new</span> InclinationFilter());</span><br><span class="line">	graph.Filters.Add(<span class="keyword">new</span> FrequencyFilter());</span><br><span class="line">	<span class="comment">//graph.Filters.Add(new CountFilter());</span></span><br><span class="line">	plotter.Children.Add(graph);</span><br><span class="line">	<span class="keyword">return</span> graph;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>LineGraph的继承关系<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">System.Object</span><br><span class="line">  System.Windows.Threading.DispatcherObject</span><br><span class="line">    System.Windows.DependencyObject</span><br><span class="line">      System.Windows.Media.Visual</span><br><span class="line">        System.Windows.UIElement</span><br><span class="line">          System.Windows.FrameworkElement</span><br><span class="line">            Microsoft.Research.DynamicDataDisplay.PlotterElement</span><br><span class="line">              Microsoft.Research.DynamicDataDisplay.ViewportElement2D</span><br><span class="line">                Microsoft.Research.DynamicDataDisplay.PointsGraphBase</span><br><span class="line">                  Microsoft.Research.DynamicDataDisplay.LineGraph</span><br></pre></td></tr></table></figure></p>
<p>ChartPlotter的继承关系<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">System.Object</span><br><span class="line">  System.Windows.Threading.DispatcherObject</span><br><span class="line">    System.Windows.DependencyObject</span><br><span class="line">      System.Windows.Media.Visual</span><br><span class="line">        System.Windows.UIElement</span><br><span class="line">          System.Windows.FrameworkElement</span><br><span class="line">            System.Windows.Controls.Control</span><br><span class="line">              System.Windows.Controls.ContentControl</span><br><span class="line">                Microsoft.Research.DynamicDataDisplay.Plotter</span><br><span class="line">                  Microsoft.Research.DynamicDataDisplay.Plotter2D</span><br><span class="line">                    Microsoft.Research.DynamicDataDisplay.ChartPlotter</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="LineGraph如何绘制"><a href="#LineGraph如何绘制" class="headerlink" title="LineGraph如何绘制"></a>LineGraph如何绘制</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filters.CollectionChanged += filters_CollectionChanged;</span><br></pre></td></tr></table></figure>
<p>调用graph.Filters.Add(new InclinationFilter())之后, 触发filters_CollectionChanged事件<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">filters_CollectionChanged</span>(<span class="params"><span class="keyword">object</span> sender, NotifyCollectionChangedEventArgs e</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	filteredPoints = <span class="literal">null</span>;</span><br><span class="line">	Update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Update定义在父类<em>ViewportElement2D</em>中<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (Viewport == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	UpdateCore();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!beforeFirstUpdate)</span><br><span class="line">	&#123;</span><br><span class="line">		updateCalled = <span class="literal">true</span>;</span><br><span class="line">		InvalidateVisual();</span><br><span class="line">	&#125;</span><br><span class="line">	beforeFirstUpdate = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UpdateCore</span>(<span class="params"></span>)</span> &#123; &#125;</span><br></pre></td></tr></table></figure></p>
<p>LineGraph重写UpdateCore<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> FakePointList filteredPoints;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">UpdateCore</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (DataSource == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	Rect output = Viewport.Output;</span><br><span class="line">	<span class="keyword">var</span> transform = GetTransform();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (filteredPoints == <span class="literal">null</span> || !(transform.DataTransform <span class="keyword">is</span> IdentityTransform))</span><br><span class="line">	&#123;</span><br><span class="line">		IEnumerable&lt;Point&gt; points = GetPoints();</span><br><span class="line"></span><br><span class="line">		ContentBounds = BoundsHelper.GetViewportBounds(points, transform.DataTransform);</span><br><span class="line"></span><br><span class="line">		transform = GetTransform();</span><br><span class="line">		List&lt;Point&gt; transformedPoints = transform.DataToScreen(points);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Analysis and filtering of unnecessary points</span></span><br><span class="line">		filteredPoints = <span class="keyword">new</span> FakePointList(FilterPoints(transformedPoints),</span><br><span class="line">			output.Left, output.Right);</span><br><span class="line"></span><br><span class="line">		Offset = <span class="keyword">new</span> Vector();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>UpdateCore先是将数据转换到窗口, 然后在调用Filter对数据进行过滤(裁剪)</p>
<p>ViewportElement2D是重点，有Update，UpdateCore(纯虚函数)，OnRender(重写)，OnRenderCore(纯虚函数). OnRender原本是UIElement的纯虚函数, ViewportElement2D重写OnRender<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">bool</span> shouldReRender = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">private</span> DrawingGroup graphContents;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">sealed</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnRender</span>(<span class="params">DrawingContext drawingContext</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (Viewport == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	Rect output = Viewport.Output;</span><br><span class="line">	<span class="keyword">if</span> (output.Width == <span class="number">0</span> || output.Height == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (output.IsEmpty) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (Visibility != Visibility.Visible) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (shouldReRender || manualTranslate || renderTarget == RenderTo.Image || beforeFirstUpdate || updateCalled)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (graphContents == <span class="literal">null</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			graphContents = <span class="keyword">new</span> DrawingGroup();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (beforeFirstUpdate)</span><br><span class="line">		&#123;</span><br><span class="line">			Update();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">using</span> (DrawingContext context = graphContents.Open())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (renderTarget == RenderTo.Screen)</span><br><span class="line">			&#123;</span><br><span class="line">				RenderState state = CreateRenderState(Viewport.Visible, RenderTo.Screen);</span><br><span class="line">				OnRenderCore(context, state);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">// for future use</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		updateCalled = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// thumbnail is not created, if</span></span><br><span class="line">	<span class="comment">// 1) CreateThumbnail is false</span></span><br><span class="line">	<span class="comment">// 2) this graph has IsLayer property, set to false</span></span><br><span class="line">	<span class="keyword">if</span> (ShouldCreateThumbnail)</span><br><span class="line">	&#123;</span><br><span class="line">		RenderThumbnail();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!manualClip)</span><br><span class="line">	&#123;</span><br><span class="line">		drawingContext.PushClip(<span class="keyword">new</span> RectangleGeometry(output));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">bool</span> translate = !manualTranslate &amp;&amp; IsTranslated;</span><br><span class="line">	<span class="keyword">if</span> (translate)</span><br><span class="line">	&#123;</span><br><span class="line">		drawingContext.PushTransform(<span class="keyword">new</span> TranslateTransform(offset.X, offset.Y));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	drawingContext.DrawDrawing(graphContents);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (translate)</span><br><span class="line">	&#123;</span><br><span class="line">		drawingContext.Pop();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!manualClip)</span><br><span class="line">	&#123;</span><br><span class="line">		drawingContext.Pop();</span><br><span class="line">	&#125;</span><br><span class="line">	shouldReRender = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">OnRenderCore</span>(<span class="params">DrawingContext dc, RenderState state</span>)</span>;</span><br></pre></td></tr></table></figure></p>
<p>LineGraph重写OnRenderCore<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnRenderCore</span>(<span class="params">DrawingContext dc, RenderState state</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (DataSource == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (filteredPoints.HasPoints)</span><br><span class="line">	&#123;</span><br><span class="line">		StreamGeometry geometry = <span class="keyword">new</span> StreamGeometry();</span><br><span class="line">		<span class="keyword">using</span> (StreamGeometryContext context = geometry.Open())</span><br><span class="line">		&#123;</span><br><span class="line">			context.BeginFigure(filteredPoints.StartPoint, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">			context.PolyLineTo(filteredPoints, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		geometry.Freeze();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">const</span> Brush brush = <span class="literal">null</span>;</span><br><span class="line">		Pen pen = LinePen;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">bool</span> isTranslated = IsTranslated;</span><br><span class="line">		<span class="keyword">if</span> (isTranslated)</span><br><span class="line">		&#123;</span><br><span class="line">			dc.PushTransform(<span class="keyword">new</span> TranslateTransform(Offset.X, Offset.Y));</span><br><span class="line">		&#125;</span><br><span class="line">		dc.DrawGeometry(brush, pen, geometry);</span><br><span class="line">		<span class="keyword">if</span> (isTranslated)</span><br><span class="line">		&#123;</span><br><span class="line">			dc.Pop();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>参考:<br><strong>UIElement.OnRender Method (DrawingContext)</strong><br><a href="https://msdn.microsoft.com/en-us/library/system.windows.uielement.onrender(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/system.windows.uielement.onrender(v=vs.110).aspx</a></p>
<p><strong>DrawingContext Class</strong><br><a href="https://msdn.microsoft.com/en-us/library/system.windows.media.drawingcontext(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/system.windows.media.drawingcontext(v=vs.110).aspx</a></p>
<p>public abstract class DrawingContext : DispatcherObject, IDisposable<br>Describes visual content using draw, push, and pop commands.</p>
<p>Use a DrawingContext to populate a Visual or a Drawing with visual content.<br>Although the DrawingContext draw methods appear similar to the draw methods of the System.Drawing.Graphics type, they function very differently:DrawingContext is used with a retained mode graphics system, while the System.Drawing.Graphics type is used with an immediate mode graphics system. When you use a DrawingContext object’s draw commands, you are actually storing a set of rendering instructions (although the exact storage mechanism depends on the type of object that supplies the DrawingContext) that will later be used by the graphics system; you are not drawing to the screen in real-time. For more information about how the Windows Presentation Foundation (WPF) graphics system works, see WPF Graphics Rendering Overview.<br>You never directly instantiate a DrawingContext; you can, however, acquire a drawing context from certain methods, such as DrawingGroup.Openand DrawingVisual.RenderOpen.</p>
<p><strong>StreamGeometry Class (比Shape更轻量)</strong><br><a href="https://msdn.microsoft.com/en-us/library/system.windows.media.streamgeometry(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/system.windows.media.streamgeometry(v=vs.110).aspx</a>)<br>Defines a geometric shape, described using a StreamGeometryContext. This geometry is light-weight alternative to PathGeometry: it does not support data binding, animation, or modification.</p>
<p><strong>Optimizing Performance: 2D Graphics and Imaging</strong><br><a href="https://msdn.microsoft.com/en-us/library/bb613591(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/bb613591(v=vs.110).aspx</a><br>Since Shape objects derive from the FrameworkElement class, using them can add significantly more memory consumption in your application. If you really do not need the FrameworkElement features for your graphical content, consider using the lighter-weight Drawing objects.</p>
<p><strong>How to: Create a Shape Using a StreamGeometry</strong><br><a href="https://msdn.microsoft.com/en-us/library/ms742199(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/ms742199(v=vs.110).aspx</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/03/2D Visualization笔记(X3) DynamicDataDisplay(wpf)(二)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/03/2D Visualization笔记(X3) DynamicDataDisplay(wpf)(二)/" itemprop="url">2D Visualization笔记(X3) DynamicDataDisplay(wpf)(二)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-03T16:03:57+08:00">
                2017-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hello World Demo 分析<br>LineGraph的UpdateCore中有GetTransform和transform.DataToScreen(points). GetTransform是在父类PointsGraphBase中定义的<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> DataTransform dataTransform = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">public</span> DataTransform DataTransform</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">get</span> &#123; <span class="keyword">return</span> dataTransform; &#125;</span><br><span class="line">	<span class="keyword">set</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (dataTransform != <span class="keyword">value</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			dataTransform = <span class="keyword">value</span>;</span><br><span class="line">			Update();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> CoordinateTransform <span class="title">GetTransform</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (Plotter == <span class="literal">null</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> transform = Plotter2D.Viewport.Transform;</span><br><span class="line">	<span class="keyword">if</span> (dataTransform != <span class="literal">null</span>)</span><br><span class="line">		transform = transform.WithDataTransform(dataTransform);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> transform;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一个窗口中可以有多个Plot, 一个Plot就是一个视口(viewPort);CoordinateTransform有2个变换组成, 一个是数据变换(dataTransform), 先将数据变换到Plot(即视口viewPort), 另一个是视口变换, 将Plot变换到窗口的某一位置<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Base class for all data transforms.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Defines methods to transform point from data coordinate system to viewport coordinates and vice versa.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">DataTransform</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Transforms the point in data coordinates to viewport coordinates.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="pt"&gt;</span>The point in data coordinates.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Point <span class="title">DataToViewport</span>(<span class="params">Point pt</span>)</span>;</span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Transforms the point in viewport coordinates to data coordinates.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="pt"&gt;</span>The point in viewport coordinates.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Point <span class="title">ViewportToData</span>(<span class="params">Point pt</span>)</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> DataRect defaultDomain = DataRect.Empty;</span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Gets the data domain.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;value&gt;</span>The data domain.<span class="doctag">&lt;/value&gt;</span></span></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">virtual</span> DataRect DataDomain &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> defaultDomain; &#125; &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Research.DynamicDataDisplay</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> A central class in 2d coordinate transformation in DynamicDataDisplay.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> Provides methods to transform point from one coordinate system to another.</span></span><br><span class="line">	<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">CoordinateTransform</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="function"><span class="keyword">private</span> <span class="title">CoordinateTransform</span>(<span class="params">Rect visibleRect, Rect screenRect</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="keyword">this</span>.visibleRect = visibleRect;</span><br><span class="line">			<span class="keyword">this</span>.screenRect = screenRect;</span><br><span class="line"></span><br><span class="line">			rxToScreen = screenRect.Width / visibleRect.Width;</span><br><span class="line">			ryToScreen = screenRect.Height / visibleRect.Height;</span><br><span class="line">			cxToScreen = visibleRect.Left * rxToScreen - screenRect.Left;</span><br><span class="line">			cyToScreen = screenRect.Height + screenRect.Top + visibleRect.Top * ryToScreen;</span><br><span class="line"></span><br><span class="line">			rxToData = visibleRect.Width / screenRect.Width;</span><br><span class="line">			ryToData = visibleRect.Height / screenRect.Height;</span><br><span class="line">			cxToData = screenRect.Left * rxToData - visibleRect.Left;</span><br><span class="line">			cyToData = visibleRect.Height + visibleRect.Top + screenRect.Top * ryToData;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">#<span class="meta-keyword">region</span> Coeffs</span></span><br><span class="line">		<span class="keyword">double</span> rxToScreen;</span><br><span class="line">		<span class="keyword">double</span> ryToScreen;</span><br><span class="line">		<span class="keyword">double</span> cxToScreen;</span><br><span class="line">		<span class="keyword">double</span> cyToScreen;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">double</span> rxToData;</span><br><span class="line">		<span class="keyword">double</span> ryToData;</span><br><span class="line">		<span class="keyword">double</span> cxToData;</span><br><span class="line">		<span class="keyword">double</span> cyToData;</span><br><span class="line">		<span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">		<span class="meta">#<span class="meta-keyword">region</span> Creation methods</span></span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">internal</span> CoordinateTransform <span class="title">WithRects</span>(<span class="params">Rect visibleRect, Rect screenRect</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			CoordinateTransform copy = <span class="keyword">new</span> CoordinateTransform(visibleRect, screenRect);</span><br><span class="line">			copy.dataTransform = dataTransform;</span><br><span class="line">			<span class="keyword">return</span> copy;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Creates a new instance of CoordinateTransform with the given data transform.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="dataTransform"&gt;</span>The data transform.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> CoordinateTransform <span class="title">WithDataTransform</span>(<span class="params">DataTransform dataTransform</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="keyword">if</span> (dataTransform == <span class="literal">null</span>)</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"dataTransform"</span>);</span><br><span class="line"></span><br><span class="line">			CoordinateTransform copy = <span class="keyword">new</span> CoordinateTransform(visibleRect, screenRect);</span><br><span class="line">			copy.dataTransform = dataTransform;</span><br><span class="line">			<span class="keyword">return</span> copy;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> CoordinateTransform <span class="title">CreateDefault</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			CoordinateTransform transform = <span class="keyword">new</span> CoordinateTransform(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> transform;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">		<span class="meta">#<span class="meta-keyword">region</span> Transform methods</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Transforms point from data coordinates to screen.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="dataPoint"&gt;</span>The point in data coordinates.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Point <span class="title">DataToScreen</span>(<span class="params">Point dataPoint</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			Point viewportPoint = dataTransform.DataToViewport(dataPoint);</span><br><span class="line"></span><br><span class="line">			Point screenPoint = <span class="keyword">new</span> Point(viewportPoint.X * rxToScreen - cxToScreen,</span><br><span class="line">				cyToScreen - viewportPoint.Y * ryToScreen);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> screenPoint;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Transforms point from screen coordinates to data coordinates.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="screenPoint"&gt;</span>The point in screen coordinates.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Point <span class="title">ScreenToData</span>(<span class="params">Point screenPoint</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			Point viewportPoint = <span class="keyword">new</span> Point(screenPoint.X * rxToData - cxToData,</span><br><span class="line">				cyToData - screenPoint.Y * ryToData);</span><br><span class="line"></span><br><span class="line">			Point dataPoint = dataTransform.ViewportToData(viewportPoint);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> dataPoint;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Transforms point from viewport coordinates to screen coordinates.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="viewportPoint"&gt;</span>The point in viewport coordinates.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Point <span class="title">ViewportToScreen</span>(<span class="params">Point viewportPoint</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			Point screenPoint = <span class="keyword">new</span> Point(viewportPoint.X * rxToScreen - cxToScreen,</span><br><span class="line">				cyToScreen - viewportPoint.Y * ryToScreen);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> screenPoint;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Transforms point from screen coordinates to viewport coordinates.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="screenPoint"&gt;</span>The point in screen coordinates.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Point <span class="title">ScreenToViewport</span>(<span class="params">Point screenPoint</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			Point viewportPoint = <span class="keyword">new</span> Point(screenPoint.X * rxToData - cxToData,</span><br><span class="line">				cyToData - screenPoint.Y * ryToData);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> viewportPoint;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">		[<span class="meta">DebuggerBrowsable(DebuggerBrowsableState.Never)</span>]</span><br><span class="line">		<span class="keyword">private</span> Rect visibleRect;</span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Gets the viewport rectangle.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;value&gt;</span>The viewport rect.<span class="doctag">&lt;/value&gt;</span></span></span><br><span class="line">		<span class="keyword">public</span> Rect ViewportRect</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">get</span> &#123; <span class="keyword">return</span> visibleRect; &#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		[<span class="meta">DebuggerBrowsable(DebuggerBrowsableState.Never)</span>]</span><br><span class="line">		<span class="keyword">private</span> Rect screenRect;</span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Gets the screen rectangle.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;value&gt;</span>The screen rect.<span class="doctag">&lt;/value&gt;</span></span></span><br><span class="line">		<span class="keyword">public</span> Rect ScreenRect</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">get</span> &#123; <span class="keyword">return</span> screenRect; &#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		[<span class="meta">DebuggerBrowsable(DebuggerBrowsableState.Never)</span>]</span><br><span class="line">		<span class="keyword">private</span> DataTransform dataTransform = DataTransforms.Identity;</span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> Gets the data transform.</span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">		<span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;value&gt;</span>The data transform.<span class="doctag">&lt;/value&gt;</span></span></span><br><span class="line">		<span class="keyword">public</span> DataTransform DataTransform</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">get</span> &#123; <span class="keyword">return</span> dataTransform; &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>visibleRect是Plot所在的Rect, screenRect是窗口所在的Rect, 默认两个是重合的<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> CoordinateTransform <span class="title">CreateDefault</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CoordinateTransform transform = <span class="keyword">new</span> CoordinateTransform(<span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> transform;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/23/2D Visualization笔记(X1) SciChart(一)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/23/2D Visualization笔记(X1) SciChart(一)/" itemprop="url">2D Visualization笔记(X1) SciChart(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-23T16:49:51+08:00">
                2017-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>SciChart(3.1.4549版本)</em></p>
<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><ul>
<li>BindToDataSeriesSetView.xaml</li>
<li>NumericAxis</li>
<li>FastLineRenderableSeries</li>
<li>SciChartSurface</li>
<li>HighSpeedRenderSurface</li>
<li>ViewConverter</li>
<li>IRenderContext2D</li>
<li>IRenderPassData</li>
</ul>
<h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><ol>
<li>BindToDataSeriesSetView.xaml由NumericAxis(坐标轴), FastLineRenderableSeries(曲线), SciChartSurface(Chart区域)构成;</li>
<li>SciChartSurface的DoDrawingLoop用到IRenderSurface2D(HighSpeedRenderSurfaceu实现, 用来获取IRenderContext2D, 类似Winform中的Graphics)和ISciChartRenderer(ViewConverter实现, 以IRenderContext2D为参数进行绘制);  </li>
<li>ViewConverter的RenderLoop中会调用NumericAxis和FastLineRenderableSeries的OnDraw方法, 而IRenderContext2D和IRenderPassData是OnDraw的两个参数</li>
</ol>
<hr>
<h3 id="BindToDataSeriesSetView-xaml"><a href="#BindToDataSeriesSetView-xaml" class="headerlink" title="BindToDataSeriesSetView.xaml"></a>BindToDataSeriesSetView.xaml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">UserControl</span> <span class="attr">x:Class</span>=<span class="string">"Abt.Controls.SciChart.Example.Examples.IWantTo.UseSciChartWithMvvm.BindToDataSeriesSetView"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns</span>=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:x</span>=<span class="string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:mc</span>=<span class="string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:d</span>=<span class="string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">xmlns:SciChart</span>=<span class="string">"http://schemas.abtsoftware.co.uk/scichart"</span>  </span></span><br><span class="line"><span class="tag">             <span class="attr">mc:Ignorable</span>=<span class="string">"d"</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">d:DesignHeight</span>=<span class="string">"300"</span> <span class="attr">d:DesignWidth</span>=<span class="string">"300"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Grid</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">"32"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">RowDefinition</span> <span class="attr">Height</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Grid.RowDefinitions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Button is used to invoke a delegate in the ViewModel to append 50 points. --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Grid.Row</span>=<span class="string">"0"</span> <span class="attr">Command</span>=<span class="string">"&#123;Binding AppendDataCommand&#125;"</span> <span class="attr">Content</span>=<span class="string">"Append 50 Points"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Declare a SciChartSurface and bind to data --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">SciChart:SciChartSurface</span> <span class="attr">Grid.Row</span>=<span class="string">"1"</span>  <span class="attr">SciChart:ThemeManager.Theme</span>=<span class="string">"ExpressionLight"</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">SciChart:SciChartSurface.RenderableSeries</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SciChart:FastLineRenderableSeries</span> <span class="attr">DataSeries</span>=<span class="string">"&#123;Binding ChartData&#125;"</span> <span class="attr">SeriesColor</span>=<span class="string">"#279B27"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">SciChart:SciChartSurface.RenderableSeries</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">SciChart:SciChartSurface.XAxis</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SciChart:NumericAxis</span> <span class="attr">AutoRange</span>=<span class="string">"Always"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">SciChart:SciChartSurface.XAxis</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">SciChart:SciChartSurface.YAxis</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SciChart:NumericAxis</span> <span class="attr">AutoRange</span>=<span class="string">"Always"</span> <span class="attr">GrowBy</span>=<span class="string">"0.1, 0.1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">SciChart:SciChartSurface.YAxis</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">        <span class="tag">&lt;/<span class="name">SciChart:SciChartSurface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Grid</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">UserControl</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>程序仅绘制了一条曲线和XY坐标轴</p>
<p>工具: ILSpy<br>dll: Abt.Controls.SciChart.Wpf.dll(3.1.4549版本)</p>
<p>程序中是<br>绘制1个FastLineRenderableSeries<br>绘制2个NumericAxis </p>
<hr>
<p>先看NumericAxis</p>
<h3 id="NumericAxis"><a href="#NumericAxis" class="headerlink" title="NumericAxis"></a>NumericAxis</h3><p>public class NumericAxis : AxisBase<br>public abstract class AxisBase : ContentControl, INotifyPropertyChanged, IXmlSerializable, <strong>IDrawable</strong>, IAxisParams, IHitTestable, ISuspendable, IInvalidatableElement, IAxis</p>
<p>看<strong>IDrawable</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">namespace Abt.Controls.SciChart.Visuals</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">    <span class="comment">/// Defines the base interface for an object that can be drawn</span></span><br><span class="line">    <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IDrawable</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets or sets the width of the &lt;see cref="T:Abt.Controls.SciChart.Visuals.IDrawable" /&gt; in pixels</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        <span class="keyword">double</span> Width</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">            set;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets or sets the height of the &lt;see cref="T:Abt.Controls.SciChart.Visuals.IDrawable" /&gt; in pixels</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        <span class="keyword">double</span> Height</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">            set;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Called when the instance is drawn</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="renderContext"&gt;The &lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.IRenderContext2D" /&gt; used for drawing&lt;/param&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;param name="renderPassData"&gt;Contains arguments and parameters for this render pass&lt;/param&gt;</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">OnDraw</span><span class="params">(IRenderContext2D renderContext, IRenderPassData renderPassData)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>回看<strong>AxisBase</strong>类中有OnDraw方法, 有计算ticks, 绘制坐标网格, 绘制坐标轴; NumericAxis使用OnDraw进行绘制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// Called when the instance is drawn</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="renderContext"&gt;The &lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.IRenderContext2D" /&gt; used for drawing&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;param name="renderPassData"&gt;Contains arguments and parameters for this render pass&lt;/param&gt;</span></span><br><span class="line"><span class="comment">/// &lt;seealso cref="T:Abt.Controls.SciChart.Visuals.IDrawable" /&gt;</span></span><br><span class="line"><span class="comment">/// &lt;seealso cref="T:Abt.Controls.SciChart.Rendering.Common.IRenderContext2D" /&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDraw</span><span class="params">(IRenderContext2D renderContext, IRenderPassData renderPassData)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.IsSuspended &amp;&amp; <span class="keyword">this</span>.DisconnectSelection() &amp;&amp; <span class="keyword">this</span>.IsLicenseValid)</span><br><span class="line">    &#123;</span><br><span class="line">        using (IUpdateSuspender updateSuspender = <span class="keyword">this</span>.SuspendUpdates())</span><br><span class="line">        &#123;</span><br><span class="line">            updateSuspender.ResumeTargetOnDispose = <span class="keyword">false</span>;</span><br><span class="line">            Stopwatch stopwatch = Stopwatch.StartNew();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.LabelProvider != <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.LabelProvider.OnBeginAxisDraw();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.uriInstance = <span class="keyword">this</span>.CalculateTicks();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.IsPrimaryAxis)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.DrawGridLines(renderContext, <span class="keyword">this</span>.uriInstance);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (base.Visibility == Visibility.Visible &amp;&amp; <span class="keyword">this</span>.ConnectContext())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.OnDrawAxis(<span class="keyword">this</span>.uriInstance);</span><br><span class="line">            &#125;</span><br><span class="line">            stopwatch.Stop();</span><br><span class="line">            SciChartDebugLogger.Instance.WriteLine(<span class="string">"Drawn &#123;0&#125;: Width=&#123;1&#125;, Height=&#123;2&#125; in &#123;3&#125;ms"</span>, <span class="keyword">new</span> object[]</span><br><span class="line">            &#123;</span><br><span class="line">                base.GetType().Name,</span><br><span class="line">                base.ActualWidth,</span><br><span class="line">                base.ActualHeight,</span><br><span class="line">                stopwatch.ElapsedMilliseconds</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>再看FastLineRenderableSeries </p>
<h3 id="FastLineRenderableSeries"><a href="#FastLineRenderableSeries" class="headerlink" title="FastLineRenderableSeries"></a>FastLineRenderableSeries</h3><p>public class FastLineRenderableSeries : BaseRenderableSeries<br>FastLineRenderableSeries中发现方法<strong>InternalDraw</strong><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Draws the series using the <span class="doctag">&lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.IRenderContext2D" /&gt;</span> and the <span class="doctag">&lt;see cref="T:Abt.Controls.SciChart.Visuals.RenderableSeries.IRenderPassData" /&gt;</span> passed in</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="renderContext"&gt;</span>The render context. This is a graphics object which has methods to draw lines, quads and polygons to the screen<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="renderPassData"&gt;</span>The render pass data. Contains a resampled <span class="doctag">&lt;see cref="T:Abt.Controls.SciChart.Model.DataSeries.IPointSeries" /&gt;</span>, the <span class="doctag">&lt;see cref="T:Abt.Controls.SciChart.IndexRange" /&gt;</span> of points on the screen</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> and the current YAxis and XAxis <span class="doctag">&lt;see cref="T:Abt.Controls.SciChart.Numerics.CoordinateCalculators.ICoordinateCalculator`1" /&gt;</span> to convert data-points to screen points<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">InternalDraw</span>(<span class="params">IRenderContext2D renderContext, IRenderPassData renderPassData</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, Color&gt; func = <span class="literal">null</span>;</span><br><span class="line">    IPointSeries pointSeries = <span class="keyword">base</span>.CurrentRenderPassData.PointSeries;</span><br><span class="line">    LinesEnumerable linesEnumerable = <span class="keyword">new</span> LinesEnumerable(pointSeries, renderPassData.XCoordinateCalculator, renderPassData.YCoordinateCalculator, <span class="keyword">this</span>.IsDigitalLine);</span><br><span class="line">    Func&lt;Color, IPen2D&gt; func2 = <span class="literal">null</span>;</span><br><span class="line">    FastLineRenderableSeries.ToolbarCollection toolbarCollection = <span class="keyword">new</span> FastLineRenderableSeries.ToolbarCollection();</span><br><span class="line">    toolbarCollection.uriInstance = <span class="keyword">new</span> DeploymentInvoker(renderContext, <span class="keyword">base</span>.AntiAliasing, (<span class="keyword">float</span>)<span class="keyword">base</span>.StrokeThickness, <span class="keyword">base</span>.Opacity);</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">base</span>.SeriesColor.A != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">base</span>.PaletteProvider != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                IEnumerable&lt;Point&gt; arg_98_1 = linesEnumerable;</span><br><span class="line">                <span class="keyword">bool</span> arg_98_2 = <span class="keyword">base</span>.DrawNaNAs == LineDrawMode.ClosedLines;</span><br><span class="line">                <span class="keyword">if</span> (func == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    func = <span class="keyword">new</span> Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, Color&gt;(<span class="keyword">this</span>.DisconnectSelection);</span><br><span class="line">                &#125;</span><br><span class="line">                Func&lt;<span class="keyword">double</span>, <span class="keyword">double</span>, Color&gt; arg_98_3 = func;</span><br><span class="line">                <span class="keyword">if</span> (func2 == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    func2 = <span class="keyword">new</span> Func&lt;Color, IPen2D&gt;(toolbarCollection.ViewReference);</span><br><span class="line">                &#125;</span><br><span class="line">                renderContext.DrawLinesReusablePens(arg_98_1, arg_98_2, arg_98_3, func2);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.DisconnectSelection(renderContext, <span class="keyword">base</span>.SeriesColor, linesEnumerable, <span class="keyword">base</span>.DrawNaNAs == LineDrawMode.ClosedLines, (<span class="keyword">this</span>.StrokeDashArray != <span class="literal">null</span>) ? <span class="keyword">this</span>.StrokeDashArray.ToArray&lt;<span class="keyword">double</span>&gt;() : <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (toolbarCollection.uriInstance != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ((IDisposable)toolbarCollection.uriInstance).Dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    IPointMarker pointMarker = <span class="keyword">base</span>.GetPointMarker();</span><br><span class="line">    <span class="keyword">if</span> (pointMarker != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.IsDigitalLine)</span><br><span class="line">        &#123;</span><br><span class="line">            linesEnumerable = <span class="keyword">new</span> LinesEnumerable(pointSeries, renderPassData.XCoordinateCalculator, renderPassData.YCoordinateCalculator, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">using</span> (IPen2D pen2D = renderContext.CreatePen(<span class="keyword">base</span>.SeriesColor, <span class="keyword">base</span>.AntiAliasing, (<span class="keyword">float</span>)<span class="keyword">base</span>.StrokeThickness, <span class="keyword">base</span>.Opacity, <span class="literal">null</span>, PenLineCap.Round))</span><br><span class="line">        &#123;</span><br><span class="line">            IPointMarker arg_156_0 = pointMarker;</span><br><span class="line">            IEnumerable&lt;Point&gt; arg_14E_0 = linesEnumerable;</span><br><span class="line">            <span class="keyword">if</span> (FastLineRenderableSeries.CS$&lt;&gt;<span class="number">9</span>__CachedAnonymousMethodDelegate4 == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                FastLineRenderableSeries.CS$&lt;&gt;<span class="number">9</span>__CachedAnonymousMethodDelegate4 = <span class="keyword">new</span> Func&lt;Point, <span class="keyword">bool</span>&gt;(FastLineRenderableSeries.DisconnectSelection);</span><br><span class="line">            &#125;</span><br><span class="line">            arg_156_0.Draw(renderContext, arg_14E_0.Where(FastLineRenderableSeries.CS$&lt;&gt;<span class="number">9</span>__CachedAnonymousMethodDelegate4), pen2D, <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>搜索<code>DrawLinesReusablePens</code>, 发现只有RenderContextBase实现IRenderContext2D接口, 然后DrawLinesReusablePens内部foreach遍历调用DrawLineSegment<br>后者调用DrawLine  </p>
<p><strong>那么谁调用了InternalDraw</strong><br>protected override void InternalDraw 是虚方法，那么在父类BaseRenderableSeries中找, 发现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> IDrawable.ProcessContext(IRenderContext2D uriInstance, IRenderPassData windowCache)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.CurrentRenderPassData = windowCache;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.IsValidForDrawing)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.uriInstance != uriInstance.ViewportSize)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.OnParentSurfaceViewportSizeChanged();</span><br><span class="line">            <span class="keyword">this</span>.uriInstance = uriInstance.ViewportSize;</span><br><span class="line">        &#125;</span><br><span class="line">        Stopwatch stopwatch = <span class="keyword">new</span> Stopwatch();</span><br><span class="line">        stopwatch.Start();</span><br><span class="line">        <span class="keyword">this</span>.InternalDraw(uriInstance, windowCache);</span><br><span class="line">        stopwatch.Stop();</span><br><span class="line">        SciChartDebugLogger.Instance.WriteLine(<span class="string">"&#123;0&#125; DrawTime: &#123;1&#125;ms"</span>, <span class="keyword">new</span> object[]</span><br><span class="line">        &#123;</span><br><span class="line">            base.GetType().Name,</span><br><span class="line">            stopwatch.ElapsedMilliseconds</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而且没有找到OnDraw方法，初步推断<strong>IDrawable.ProcessContext就是OnDraw</strong></p>
<hr>
<p>结束了FastLineRenderableSeries和NumericAxis, 再来看<br><strong>SciChartSurface</strong><br>它是如何调用FastLineRenderableSeries和NumericAxis的OnDraw</p>
<p>SciChartSurface的父类是SciChartSurfaceBase (SciChartSurfaceBase 继承Control，base指Control)，里面有一个虚方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// The inner drawing loop. Called once per frame. Do your drawing here. </span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">DoDrawingLoop</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>由于是protected，该方法在<code>public virtual void InvalidateElement()</code>中被用到，终于出现public了<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// Asynchronously requests that the element redraws itself plus children.</span></span><br><span class="line"><span class="comment">/// Will be ignored if the element is ISuspendable and currently IsSuspended (within a SuspendUpdates/ResumeUpdates call)</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> virtual <span class="keyword">void</span> <span class="title">InvalidateElement</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.IsSuspended)</span><br><span class="line">    &#123;</span><br><span class="line">        SciChartDebugLogger.Instance.WriteLine(<span class="string">"SciChartSurface.IsSuspended=true. Ignoring InvalidateElement() call"</span>, <span class="keyword">new</span> object[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!OptionsList.SearchOptions() &amp;&amp; <span class="keyword">this</span>.RenderPriority != RenderPriority.Immediate)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.uriInstance != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.uriInstance.InvalidateElement();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.Services.GetService&lt;ProjectSettings&gt;().SelectClient(<span class="keyword">new</span> Action(<span class="keyword">this</span>.DoDrawingLoop), DispatcherPriority.Normal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>InvalidateElement在SciChartSurfaceBase中的OnSciChartSurfaceLoaded中被调用, 后者在OnLoad中被调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;summary&gt;</span></span><br><span class="line"><span class="comment">/// Forces initialization of the SciChartSurface in the case it is being used to render off-screen (on server)</span></span><br><span class="line"><span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnLoad</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.OnSciChartSurfaceLoaded();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>回到SciChartSurface看DoDrawingLoop</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> override <span class="keyword">void</span> <span class="title">DoDrawingLoop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.windowCache)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        using (IRenderContext2D renderContext = <span class="keyword">this</span>.uriInstance.GetRenderContext()) <span class="comment">//         private IRenderSurface2D uriInstance;</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                RendererErrorCode rendererErrorCode = <span class="keyword">this</span>.uriInstance.RenderLoop(renderContext); <span class="comment">//          private ISciChartRenderer uriInstance;</span></span><br><span class="line">                <span class="keyword">if</span> (!GroupSettings.keywordsMap.Equals(rendererErrorCode) &amp;&amp; base.DebugWhyDoesntSciChartRender)</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">" SciChartSurface didn't render, "</span> + rendererErrorCode);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception caught)</span><br><span class="line">            &#123;</span><br><span class="line">                base.OnRenderFault(caught);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception caught2)</span><br><span class="line">    &#123;</span><br><span class="line">        base.OnRenderFault(caught2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>搜索<code>GetRenderContext</code>和<code>RenderLoop</code>, 可知<br>private IRenderSurface2D uriInstance可以认为是HighSpeedRenderSurface<br>private ISciChartRenderer uriInstance;是ViewConverter </p>
<hr>
<h4 id="HighSpeedRenderSurface"><a href="#HighSpeedRenderSurface" class="headerlink" title="HighSpeedRenderSurface"></a>HighSpeedRenderSurface</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">namespace Abt.Controls.SciChart.Rendering.HighSpeedRasterizer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">    <span class="comment">/// Provides a &lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.RenderSurfaceBase" /&gt; implementation that uses a High-Speed software rasterizer, capable of outputting many millions of points (line-series) </span></span><br><span class="line">    <span class="comment">/// at interactive framerates. The downside is, the &lt;see cref="T:Abt.Controls.SciChart.Rendering.HighSpeedRasterizer.HighSpeedRenderSurface" /&gt; uses integer fixed-point math which results in jagged lines. </span></span><br><span class="line">    <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">    <span class="comment">/// &lt;seealso cref="T:Abt.Controls.SciChart.Rendering.HighQualityRasterizer.HighQualityRenderSurface" /&gt;</span></span><br><span class="line">    <span class="comment">/// &lt;seealso cref="T:Abt.Controls.SciChart.Rendering.Common.RenderSurfaceBase" /&gt;</span></span><br><span class="line">    <span class="comment">/// &lt;seealso cref="T:Abt.Controls.SciChart.Rendering.Common.IRenderContext2D" /&gt;</span></span><br><span class="line">    [AbtLicenseProvider(typeof(XmlFileSite))]</span><br><span class="line">    public class HighSpeedRenderSurface : RenderSurfaceBase</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// When overridden in a derived class, returns a RenderContext valid for the current render pass</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns&gt;&lt;/returns&gt;</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> override IRenderContext2D <span class="title">GetRenderContext</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.RenderWriteableBitmap.ViewReference(base.Image, <span class="keyword">this</span>.uriInstance);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>protected WriteableBitmap RenderWriteableBitmap;<br>WriteableBitmap<br><a href="https://msdn.microsoft.com/en-us/library/system.windows.media.imaging.writeablebitmap(v=vs.110).aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/system.windows.media.imaging.writeablebitmap(v=vs.110).aspx</a><br>WriteableBitmap使用的双缓冲技术</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Use the WriteableBitmap class to update and render a bitmap on a per-frame basis. This is useful for generating algorithmic content, such as a fractal image, and for data visualization, such as a music visualizer.</span><br><span class="line">The WriteableBitmap class uses two buffers. The back buffer is allocated in system memory and accumulates content that is not currently displayed. The front buffer is allocated in system memory and contains the content that is currently displayed. The rendering system copies the front buffer to video memory for display.</span><br><span class="line">Two threads use these buffers. The user interface (UI) thread generates the UI but does not present it to the screen. The UI thread responds to user input, timers, and other events. An application can have multiple UI threads. The render thread composes and renders changes from the UI thread. There is only one render thread per application.</span><br><span class="line">The UI thread writes content to the back buffer. The render thread reads content from the front buffer and copies it to video memory. Changes to the back buffer are tracked with changed rectangular regions.</span><br></pre></td></tr></table></figure>
<p>ViewReference是扩展方法, 经常出现这个ViewReference, 不是特别清楚意义</p>
<hr>
<h4 id="ViewConverter"><a href="#ViewConverter" class="headerlink" title="ViewConverter"></a>ViewConverter</h4><p>internal class ViewConverter : ISciChartRenderer<br>看ViewConverter的RenderLoop方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> RendererErrorCode <span class="title">RenderLoop</span><span class="params">(IRenderContext2D renderContext)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//...忽略</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    using (IUpdateSuspender updateSuspender = <span class="keyword">this</span>.uriInstance.SuspendUpdates())</span><br><span class="line">    &#123;</span><br><span class="line">        updateSuspender.ResumeTargetOnDispose = <span class="keyword">false</span>;</span><br><span class="line">        SciChartDebugLogger.Instance.WriteLine(<span class="string">"Beginning Render Loop ... "</span>, <span class="keyword">new</span> object[<span class="number">0</span>]);</span><br><span class="line">        Size size = <span class="keyword">this</span>.ViewReference(<span class="keyword">this</span>.uriInstance);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.ViewReference(<span class="keyword">this</span>.uriInstance, size, out result))</span><br><span class="line">        &#123;</span><br><span class="line">            RenderPassInfo renderPassInfo = ViewConverter.ViewReference(<span class="keyword">this</span>.uriInstance, size);</span><br><span class="line">            renderContext.Clear();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//绘制坐标轴</span></span><br><span class="line">            ViewConverter.ViewReference(<span class="keyword">this</span>.uriInstance, renderPassInfo, renderContext);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//绘制renderableSeries</span></span><br><span class="line">            ViewConverter.SelectClient(<span class="keyword">this</span>.uriInstance, renderPassInfo, renderContext);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//更新Annotations</span></span><br><span class="line">            ViewConverter.ViewReference(<span class="keyword">this</span>.uriInstance, renderPassInfo);</span><br><span class="line">            <span class="keyword">this</span>.uriInstance.OnSciChartRendered();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>绘制坐标轴, 出现OnDraw<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">internal <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ViewReference</span><span class="params">(ISciChartSurface uriInstance, RenderPassInfo windowCache, IRenderContext2D lastKeywords)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    foreach (IAxis current in uriInstance.XAxes)</span><br><span class="line">    &#123;</span><br><span class="line">        current.ValidateAxis();</span><br><span class="line">        current.OnDraw(lastKeywords, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    foreach (IAxis current2 in uriInstance.YAxes)</span><br><span class="line">    &#123;</span><br><span class="line">        current2.ValidateAxis();</span><br><span class="line">        current2.OnDraw(lastKeywords, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    lastKeywords.Layers.Flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>遍历绘制renderableSeries<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">internal <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SelectClient</span><span class="params">(ISciChartSurface uriInstance, RenderPassInfo windowCache, IRenderContext2D lastKeywords)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (windowCache.RenderableSeries == <span class="keyword">null</span>)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     List&lt;<span class="keyword">int</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; windowCache.RenderableSeries.Length; i++)</span><br><span class="line">     &#123;</span><br><span class="line">         IRenderableSeries renderableSeries = windowCache.RenderableSeries[i];</span><br><span class="line">         <span class="keyword">if</span> (renderableSeries != <span class="keyword">null</span>)</span><br><span class="line">         &#123;</span><br><span class="line">             renderableSeries.XAxis = uriInstance.XAxes.GetAxisById(renderableSeries.XAxisId, <span class="keyword">true</span>);</span><br><span class="line">             renderableSeries.YAxis = uriInstance.YAxes.GetAxisById(renderableSeries.YAxisId, <span class="keyword">true</span>);</span><br><span class="line">             <span class="keyword">if</span> (windowCache.RenderableSeries[i].IsSelected)</span><br><span class="line">             &#123;</span><br><span class="line">                 list.Add(i);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">             &#123;</span><br><span class="line">                 ViewConverter.ViewReference(uriInstance, windowCache, lastKeywords, i);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     foreach (<span class="keyword">int</span> current in list)</span><br><span class="line">     &#123;</span><br><span class="line">         ViewConverter.ViewReference(uriInstance, windowCache, lastKeywords, current);</span><br><span class="line">     &#125;</span><br><span class="line">     uriInstance.Services.GetService&lt;IEventAggregator&gt;().Publish&lt;SciChartRenderedMessage&gt;(<span class="keyword">new</span> SciChartRenderedMessage(uriInstance, lastKeywords));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ViewReference</span><span class="params">(ISciChartSurface uriInstance, RenderPassInfo windowCache, IRenderContext2D lastKeywords, <span class="keyword">int</span> categoryDisposed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    IRenderableSeries renderableSeries = windowCache.RenderableSeries[categoryDisposed];</span><br><span class="line">    ICoordinateCalculator&lt;<span class="keyword">double</span>&gt; yCoordinateCalculator;</span><br><span class="line">    ICoordinateCalculator&lt;<span class="keyword">double</span>&gt; xCoordinateCalculator;</span><br><span class="line">    <span class="keyword">if</span> (windowCache.YCoordinateCalculators.TryGetValue(renderableSeries.YAxisId, out yCoordinateCalculator) &amp;&amp; windowCache.XCoordinateCalculators.TryGetValue(renderableSeries.XAxisId, out xCoordinateCalculator))</span><br><span class="line">    &#123;</span><br><span class="line">        RenderPassData renderPassData = <span class="keyword">new</span> RenderPassData(windowCache.IndicesRanges[categoryDisposed], xCoordinateCalculator, yCoordinateCalculator, windowCache.PointSeries[categoryDisposed]);</span><br><span class="line">        renderableSeries.OnDraw(lastKeywords, renderPassData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>最后看一下IRenderContext2D和IRenderPassData </p>
<h4 id="IRenderContext2D"><a href="#IRenderContext2D" class="headerlink" title="IRenderContext2D"></a>IRenderContext2D</h4><p>相当于Winform中的Graphics<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">namespace Abt.Controls.SciChart.Rendering.Common</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//删掉了一些</span></span><br><span class="line">    <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">    <span class="comment">/// Defines the interface to a 2D RenderContext, allowing drawing, blitting and creation of pens and brushes on the &lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.RenderSurfaceBase" /&gt;</span></span><br><span class="line">    <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">    <span class="comment">/// &lt;remarks&gt;The &lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.IRenderContext2D" /&gt; is a graphics context valid for the current render pass. Any class which implements &lt;see cref="T:Abt.Controls.SciChart.Visuals.IDrawable" /&gt; has an OnDraw method</span></span><br><span class="line">    <span class="comment">/// in which an &lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.IRenderContext2D" /&gt; is passed in. Use this to draw penned lines, fills, rectangles, ellipses and blit graphics to the screen.&lt;/remarks&gt;</span></span><br><span class="line">    public interface IRenderContext2D : IDisposable</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets a collection of &lt;see cref="T:Abt.Controls.SciChart.Rendering.Common.RenderOperationLayers" /&gt;, which allow rendering operations to be posted to a layered queue for later</span></span><br><span class="line">        <span class="comment">/// execution in order (and correct Z-ordering). </span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;example&gt;</span></span><br><span class="line">        <span class="comment">///     &lt;code title="RenderOperationLayers Example" description="Demonstrates how to enqueue operations to the RenderOperationLayers collection and later flush to ensure rendering operations get processed in the correct Z-order" lang="C#"&gt;</span></span><br><span class="line">        <span class="comment">/// RenderOperationLayers layers = renderContext.Layers;</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// // Enqueue some operations in the layers in any order</span></span><br><span class="line">        <span class="comment">/// layers[RenderLayer.AxisMajorGridlines].Enqueue(() =&amp;gt; renderContext.DrawLine(/* .. */));</span></span><br><span class="line">        <span class="comment">/// layers[RenderLayer.AxisBands].Enqueue(() =&amp;gt; renderContext.DrawRectangle(/* .. */));</span></span><br><span class="line">        <span class="comment">/// layers[RenderLayer.AxisMinorGridlines].Enqueue(() =&amp;gt; renderContext.DrawLine(/* .. */));</span></span><br><span class="line">        <span class="comment">///</span></span><br><span class="line">        <span class="comment">/// // Processes all layers by executing enqueued operations in order of adding, </span></span><br><span class="line">        <span class="comment">/// // and in Z-order of layers</span></span><br><span class="line">        <span class="comment">/// layers.Flush();&lt;/code&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;/example&gt;</span></span><br><span class="line">        RenderOperationLayers Layers</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets the current size of the viewport.</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        Size ViewportSize</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">IBrush2D <span class="title">CreateBrush</span><span class="params">(Color color, <span class="keyword">double</span> opacity = <span class="number">1.0</span>, bool? alphaBlend = <span class="keyword">null</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">IPen2D <span class="title">CreatePen</span><span class="params">(Color color, bool antiAliasing, <span class="keyword">float</span> strokeThickness, <span class="keyword">double</span> opacity = <span class="number">1.0</span>, <span class="keyword">double</span>[] strokeDashArray = <span class="keyword">null</span>, PenLineCap strokeEndLineCap = PenLineCap.Round)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">ISprite2D <span class="title">CreateSprite</span><span class="params">(FrameworkElement fe)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">DrawSprite</span><span class="params">(Point destPoint, ISprite2D srcSprite, Rect srcRect)</span></span>;</span><br><span class="line">   </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">FillRectangle</span><span class="params">(IBrush2D brush, Point pt1, Point pt2, <span class="keyword">double</span> gradientRotationAngle)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">FillPolygon</span><span class="params">(IBrush2D brush, IEnumerable&lt;Point&gt; points)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">FillArea</span><span class="params">(IBrush2D brush, IEnumerable&lt;Tuple&lt;Point, Point&gt;&gt; lines, <span class="keyword">double</span> gradientRotationAngle = <span class="number">0.0</span>, bool isVerticalChart = <span class="keyword">false</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">DrawQuad</span><span class="params">(IPen2D pen, Point pt1, Point pt2)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">DrawEllipse</span><span class="params">(<span class="keyword">double</span> width, <span class="keyword">double</span> height, Point center, IBrush2D brush, IPen2D pen)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">DrawLine</span><span class="params">(IPen2D pen, Point pt1, Point pt2)</span></span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="IRenderPassData"><a href="#IRenderPassData" class="headerlink" title="IRenderPassData"></a>IRenderPassData</h4><p>这个接口将原始数据变换到Chart所在的视窗上<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">using Abt.Controls.SciChart.Model.DataSeries;</span><br><span class="line">using Abt.Controls.SciChart.Numerics.CoordinateCalculators;</span><br><span class="line">using System;</span><br><span class="line"></span><br><span class="line">namespace Abt.Controls.SciChart.Visuals.RenderableSeries</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">    <span class="comment">/// Defines the interface to &lt;see cref="T:Abt.Controls.SciChart.Visuals.RenderableSeries.RenderPassData" /&gt;, the data used in a single render pass by &lt;see cref="T:Abt.Controls.SciChart.Visuals.RenderableSeries.BaseRenderableSeries" /&gt; derived types</span></span><br><span class="line">    <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRenderPassData</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets the integer indices of the X-Data array that are currently in range.</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;returns&gt;The indices to the X-Data that are currently in range&lt;/returns&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;example&gt;If the input X-data is 0...100 in steps of 1, the VisibleRange is 10, 30 then the PointRange will be 10, 30&lt;/example&gt;</span></span><br><span class="line">        <span class="comment">/// &lt;remarks&gt;&lt;/remarks&gt;</span></span><br><span class="line">        IndexRange PointRange </span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets the current point series.</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        IPointSeries PointSeries</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets a value, indicating whether current chart is vertical</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        bool IsVerticalChart</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets the current Y coordinate calculator.</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        ICoordinateCalculator&lt;<span class="keyword">double</span>&gt; YCoordinateCalculator</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// &lt;summary&gt;</span></span><br><span class="line">        <span class="comment">/// Gets the current X coordinate calculator.</span></span><br><span class="line">        <span class="comment">/// &lt;/summary&gt;</span></span><br><span class="line">        ICoordinateCalculator&lt;<span class="keyword">double</span>&gt; XCoordinateCalculator</span><br><span class="line">        &#123;</span><br><span class="line">            get;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/22/P&P笔记(Z3) 工具使用(三)(totalcommander)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/22/P&P笔记(Z3) 工具使用(三)(totalcommander)/" itemprop="url">P&P笔记(Z3)工具使用(三)(totalcommander)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-22T08:52:58+08:00">
                2017-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="文件-夹-操作"><a href="#文件-夹-操作" class="headerlink" title="文件(夹)操作"></a>文件(夹)操作</h3><ul>
<li>文件数字名称排序(显示成1、10、2、20、3、30、4、40, 按理显示成1、2、3、4、10、20、30、40)<ul>
<li>wincmd.ini中修改为SortUpper=2</li>
</ul>
</li>
</ul>
<ul>
<li>显示SVN图标<ol>
<li><code>SVN Settings</code>-&gt;<code>Icon Overlays</code>中<code>Show overlays and context menu only in explorer</code>没有选中</li>
<li>TC中在<code>设置</code>-&gt;<code>选项</code>-&gt;<code>显示</code>-&gt;<code>图标</code>中把<code>显示覆盖图标</code>选上</li>
</ol>
</li>
</ul>
<ul>
<li>压缩<ul>
<li>alt+F5</li>
</ul>
</li>
</ul>
<ul>
<li>解压<ul>
<li>alt+F9 </li>
<li>backspace 解压到当前目录</li>
</ul>
</li>
</ul>
<ul>
<li>新建文件<ul>
<li>shift+F4 </li>
<li>F4 (默认用notepad.exe打开)</li>
</ul>
</li>
</ul>
<ul>
<li><p>右键菜单: shift+F9</p>
</li>
<li><p>文件属性窗口: alt+enter</p>
</li>
<li><p>文件大小: ctrl+L</p>
</li>
<li><p>搜索插件: <a href="http://totalcmd.net/plugring/Google_like_QS.html" target="_blank" rel="noopener">QuickSearch eXtended</a></p>
</li>
</ul>
<h3 id="页签操作"><a href="#页签操作" class="headerlink" title="页签操作"></a>页签操作</h3><ul>
<li>新建页签: ctrl+T</li>
<li>左右窗口焦点切换: tab</li>
<li>后退和前进: alt+方向键</li>
<li>常用目录: ctrl+D</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>命令行<ul>
<li>按下→方向键，将光标定位到命令行</li>
<li>chrome下载完文件后打开文件所在目录，复制该目录的路径，在TC的命令行中先输入命令cd，然后粘贴路径，这样就可以在TC中快速到达该目录。</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zmapleaf</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">67</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zmapleaf</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
