<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="编程,">










<meta name="description" content="之前几篇笔记都是以图形资源为例, 对于游戏程序员来说, 可能打交道更多的资源文件是配置文件或者说数据文件. 而XML一般是配置文件的首选, 无论在MonoGame, 还是Flash, 抑或Unity3D. 官方对XML在Content Pipeline中的介绍如下(https://msdn.microsoft.com/en-us/library/ff604981.aspx) Game assets">
<meta name="keywords" content="编程">
<meta property="og:type" content="article">
<meta property="og:title" content="MonoGame笔记(十五)XML in the Content Pipeline">
<meta property="og:url" content="http://yoursite.com/2017/12/20/MonoGame笔记(十五)XML in the  Content Pipeline/index.html">
<meta property="og:site_name" content="远">
<meta property="og:description" content="之前几篇笔记都是以图形资源为例, 对于游戏程序员来说, 可能打交道更多的资源文件是配置文件或者说数据文件. 而XML一般是配置文件的首选, 无论在MonoGame, 还是Flash, 抑或Unity3D. 官方对XML在Content Pipeline中的介绍如下(https://msdn.microsoft.com/en-us/library/ff604981.aspx) Game assets">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-xml-1.png">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-xml-2.png">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-xml-3.png">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-xml-4.png">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-xml-5.png">
<meta property="og:updated_time" content="2017-12-20T06:36:00.336Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MonoGame笔记(十五)XML in the Content Pipeline">
<meta name="twitter:description" content="之前几篇笔记都是以图形资源为例, 对于游戏程序员来说, 可能打交道更多的资源文件是配置文件或者说数据文件. 而XML一般是配置文件的首选, 无论在MonoGame, 还是Flash, 抑或Unity3D. 官方对XML在Content Pipeline中的介绍如下(https://msdn.microsoft.com/en-us/library/ff604981.aspx) Game assets">
<meta name="twitter:image" content="http://yoursite.com/img/monogame-contentpipeline-xml-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/12/20/MonoGame笔记(十五)XML in the  Content Pipeline/">





  <title>MonoGame笔记(十五)XML in the Content Pipeline | 远</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">远</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/20/MonoGame笔记(十五)XML in the  Content Pipeline/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MonoGame笔记(十五)XML in the Content Pipeline</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-20T13:34:37+08:00">
                2017-12-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>之前几篇笔记都是以图形资源为例, 对于游戏程序员来说, 可能打交道更多的资源文件是配置文件或者说数据文件. 而XML一般是配置文件的首选, 无论在MonoGame, 还是Flash, 抑或Unity3D. 官方对XML在Content Pipeline中的介绍如下(<a href="https://msdn.microsoft.com/en-us/library/ff604981.aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/ff604981.aspx</a>)</p>
<p>Game assets managed through the Content Pipeline include graphic items such as textures, models and meshes; sound files such as dialogue or music; and custom data that governs the behavior of the game.</p>
<p><strong>Data tables</strong>, for example, are custom data that might describe different characters’ attributes or the features of each level in the game. The content and format of this data is specific to the requirements of the game. Custom game data in the form of an XML file also can be loaded into your game through the standard features of the Content Pipeline.</p>
<p>When the Content Pipeline is used, the game does not have to parse the XML format in which the game data is originally stored. Data loaded by the game through ContentManager is read in deserialized form directly into a managed code object.</p>
<p>上面的介绍还是有些抽象. 看看官方的样例RolePlayingGameStarterkit中是怎么做的.<br>下图是英雄和NPC的数据配置<br><img src="/img/monogame-contentpipeline-xml-1.png" alt=""><br>以QuestNPCs目录下的Ayttas.xml为例<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">XnaContent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Asset</span> <span class="attr">Type</span>=<span class="string">"RolePlayingGameData.QuestNpc"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Name</span>&gt;</span>Ayttas<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">MapSprite</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">TextureName</span>&gt;</span>Characters\Villager2IdleRight<span class="tag">&lt;/<span class="name">TextureName</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">FrameDimensions</span>&gt;</span>92 120<span class="tag">&lt;/<span class="name">FrameDimensions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">FramesPerRow</span>&gt;</span>6<span class="tag">&lt;/<span class="name">FramesPerRow</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">SourceOffset</span>&gt;</span>46 89<span class="tag">&lt;/<span class="name">SourceOffset</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">Animations</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">MapSprite</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">MapIdleAnimationInterval</span>&gt;</span>150<span class="tag">&lt;/<span class="name">MapIdleAnimationInterval</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">IntroductionDialogue</span>&gt;</span>Welcome to Apple Village!  Unfortunately, we're not in the best of shape right now because of these monstrosities.  But enjoy your stay anyway!  What choice is there, after all?<span class="tag">&lt;/<span class="name">IntroductionDialogue</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Asset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">XnaContent</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>其中和标签很关键, 前者表示该XML是一个Content, 后者表面是以哪个类去用该XML. 有了后者, 就可以用content.Load<questnpc>(@”Ayttas”);</questnpc></p>
<p>使用内置的XMLImporter作为Content Pipeline中的导入器<br><img src="/img/monogame-contentpipeline-xml-2.png" alt=""></p>
<p>XML中也可以是集合数据<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">XnaContent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Asset</span> <span class="attr">Type</span>=<span class="string">"System.Collections.Generic.List[XmlContentSampleShared.Sprite]"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Position</span>&gt;</span>100 100<span class="tag">&lt;/<span class="name">Position</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Rotation</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Rotation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>.2 .2<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextureAsset</span>&gt;</span>crate<span class="tag">&lt;/<span class="name">TextureAsset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Position</span>&gt;</span>400 300<span class="tag">&lt;/<span class="name">Position</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Rotation</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Rotation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>.2 .2<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextureAsset</span>&gt;</span>crate<span class="tag">&lt;/<span class="name">TextureAsset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Position</span>&gt;</span>500 20<span class="tag">&lt;/<span class="name">Position</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Rotation</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Rotation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Scale</span>&gt;</span>.2 .2<span class="tag">&lt;/<span class="name">Scale</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextureAsset</span>&gt;</span>crate<span class="tag">&lt;/<span class="name">TextureAsset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Asset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">XnaContent</span></span></span><br></pre></td></tr></table></figure></p>
<p>使用sprites = Content.Load&lt;List<sprite>&gt;(@”SpriteList”);</sprite></p>
<p>XNA是如何做到的? 其实XNA的Content Pipeline对XML有特殊照顾.<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Xml;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Content.Pipeline.Serialization.Intermediate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Implements an importer for reading intermediate XML files. This is a wrapper around IntermediateSerializer.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">ContentImporter(<span class="meta-string">".xml"</span>, DisplayName = <span class="meta-string">"Xml Importer - MonoGame"</span>, DefaultProcessor = <span class="meta-string">"PassThroughProcessor"</span>)</span>]</span><br><span class="line">    public class XmlImporter : ContentImporter&lt;object&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Called by the XNA Framework when importing an intermediate file to be used as a game </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> asset. This is the method called by the XNA Framework when an asset is to be imported </span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> into an object that can be recognized by the Content Pipeline.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="filename"&gt;</span>Name of a game asset file.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="context"&gt;</span>Contains information for importing a game asset, such as a logger interface.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>The imported game asset.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">object</span> <span class="title">Import</span>(<span class="params"><span class="keyword">string</span> filename, ContentImporterContext context</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">using</span> (<span class="keyword">var</span> reader = XmlReader.Create(filename))</span><br><span class="line">                <span class="keyword">return</span> IntermediateSerializer.Deserialize&lt;<span class="keyword">object</span>&gt;(reader, filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>XmlImporter只是对IntermediateSerializer的一个简单封装. 关键在于IntermediateSerializer</p>
<blockquote>
<p>Provides methods for reading and writing XNA intermediate XML format.<br>上面那种带<xnacontent>标签的xml格式, 也叫做XNA intermediate XML format</xnacontent></p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline.Serialization.Intermediate</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// The intermediate serializer implementation is based on testing XNA behavior and the following sources:</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// http://msdn.microsoft.com/en-us/library/Microsoft.Xna.Framework.Content.Pipeline.Serialization.Intermediate.aspx</span></span><br><span class="line">    <span class="comment">// http://blogs.msdn.com/b/shawnhar/archive/2008/08/12/everything-you-ever-wanted-to-know-about-intermediateserializer.aspx</span></span><br><span class="line">    <span class="comment">// http://blogs.msdn.com/b/shawnhar/archive/2008/08/26/customizing-intermediateserializer-part-1.aspx</span></span><br><span class="line">    <span class="comment">// http://blogs.msdn.com/b/shawnhar/archive/2008/08/26/customizing-intermediateserializer-part-2.aspx</span></span><br><span class="line">    <span class="comment">// http://blogs.msdn.com/b/shawnhar/archive/2008/08/27/why-intermediateserializer-control-attributes-are-not-part-of-the-content-pipeline.aspx</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IntermediateSerializer</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Deserialize&lt;T&gt;(XmlReader input, <span class="keyword">string</span> referenceRelocationPath)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> serializer = <span class="keyword">new</span> IntermediateSerializer();</span><br><span class="line">            <span class="keyword">var</span> reader = <span class="keyword">new</span> IntermediateReader(serializer, input, referenceRelocationPath);</span><br><span class="line">            <span class="keyword">var</span> asset = <span class="keyword">default</span>(T);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!reader.MoveToElement(<span class="string">"XnaContent"</span>))</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> InvalidContentException(<span class="keyword">string</span>.Format(<span class="string">"Could not find XnaContent element in '&#123;0&#125;'."</span>,</span><br><span class="line">                                                                    referenceRelocationPath));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Initialize the namespace lookups from</span></span><br><span class="line">                <span class="comment">// the attributes on the XnaContent element.</span></span><br><span class="line">                serializer.CreateNamespaceLookup(input);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Move past the XnaContent.</span></span><br><span class="line">                input.ReadStartElement();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Read the asset.</span></span><br><span class="line">                <span class="keyword">var</span> format = <span class="keyword">new</span> ContentSerializerAttribute &#123;ElementName = <span class="string">"Asset"</span>&#125;;</span><br><span class="line">                asset = reader.ReadObject&lt;T&gt;(format);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Process the shared resources and external references.</span></span><br><span class="line">                reader.ReadSharedResources();</span><br><span class="line">                reader.ReadExternalReferences();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Move past the closing XnaContent element.</span></span><br><span class="line">                input.ReadEndElement();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (XmlException xmlException)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> reader.NewInvalidContentException(xmlException, <span class="string">"An error occured parsing."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> asset;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里不具体分析IntermediateSerializer的实现, 可以猜测的是对各种类型的序列化和反序列化.<br>下图是Microsoft.Xna.Framework.Content.Pipeline.Serialization.Intermediate命名空间下的文件<br><img src="/img/monogame-contentpipeline-xml-3.png" alt=""><br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Xml;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline.Serialization.Intermediate</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ContentTypeSerializer</span>]</span><br><span class="line">    class Vector2Serializer : ElementSerializer&lt;Vector2&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Vector2Serializer</span>(<span class="params"></span>) :</span></span><br><span class="line"><span class="function">            <span class="title">base</span>(<span class="params"><span class="string">"Vector2"</span>, <span class="number">2</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">internal</span> <span class="keyword">override</span> Vector2 <span class="title">Deserialize</span>(<span class="params"><span class="keyword">string</span>[] inputs, <span class="keyword">ref</span> <span class="keyword">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Vector2( XmlConvert.ToSingle(inputs[index++]),</span><br><span class="line">                                XmlConvert.ToSingle(inputs[index++]));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Serialize</span>(<span class="params">Vector2 <span class="keyword">value</span>, List&lt;<span class="keyword">string</span>&gt; results</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            results.Add(XmlConvert.ToString(<span class="keyword">value</span>.X));</span><br><span class="line">            results.Add(XmlConvert.ToString(<span class="keyword">value</span>.Y));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>往上一层<br><img src="/img/monogame-contentpipeline-xml-4.png" alt=""><br>发现有一个Compiler, 进去一看<br><img src="/img/monogame-contentpipeline-xml-5.png" alt=""><br>可以对比下<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> TOutput = Microsoft.Xna.Framework.Vector2;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline.Serialization.Compiler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Writes the Vector2 value to the output.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">ContentTypeWriter</span>]</span><br><span class="line">    class Vector2Writer : BuiltInContentWriter&lt;TOutput&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Writes the value to the output.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="output"&gt;</span>The output writer object.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="value"&gt;</span>The value to write to the output.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Write</span>(<span class="params">ContentWriter output, TOutput <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            output.Write(<span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个Compiler文件夹下的Writer用于对Content Processor的输出进行序列化, 而Intermediate文件夹下的Serializer是用于XML Intermediate Format的序列化和反序列化. 所以说Content Pipeline对XML有特殊照顾</p>
<p>关于IntermediateSerializer, 推荐阅读XNA团队成员的系列文章:</p>
<p>Everything you ever wanted to know about IntermediateSerializer<br><a href="http://blogs.msdn.com/b/shawnhar/archive/2008/08/12/everything-you-ever-wanted-to-know-about-intermediateserializer.aspx" target="_blank" rel="noopener">http://blogs.msdn.com/b/shawnhar/archive/2008/08/12/everything-you-ever-wanted-to-know-about-intermediateserializer.aspx</a><br>讲了如何使用XNA intermediate XML format (XML中除了普通的数据, 还可以有shared resource和external resource)</p>
<p>IntermediateSerializer vs. XmlSerializer<br><a href="http://blogs.msdn.com/b/shawnhar/archive/2008/07/28/intermediateserializer-vs-xmlserializer.aspx" target="_blank" rel="noopener">http://blogs.msdn.com/b/shawnhar/archive/2008/07/28/intermediateserializer-vs-xmlserializer.aspx</a><br>讲了IntermediateSerializer的好处</p>
<p>XML and the Content Pipeline<br><a href="http://blogs.msdn.com/b/shawnhar/archive/2008/05/30/xml-and-the-content-pipeline.aspx" target="_blank" rel="noopener">http://blogs.msdn.com/b/shawnhar/archive/2008/05/30/xml-and-the-content-pipeline.aspx</a><br>讲了IntermediateSerializer的必要性</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/编程/" rel="tag"># 编程</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/20/MonoGame笔记(十四)自定义Content Pipeline/" rel="next" title="MonoGame笔记(十四)自定义Content Pipeline">
                <i class="fa fa-chevron-left"></i> MonoGame笔记(十四)自定义Content Pipeline
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/21/MonoGame笔记(X1)Camera2D/" rel="prev" title="MonoGame笔记(X1)Camera2D">
                MonoGame笔记(X1)Camera2D <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zmapleaf</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">66</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zmapleaf</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
