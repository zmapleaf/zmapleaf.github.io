<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="编程,">










<meta name="description" content="游戏中除了代码就是资源. 代码本身也是一种资源(Unity3D中代码和资源都被组织在Asset目录下). Unity3D属于All in One, Flash有强大的Flash CS编辑资源, 而XNA也有Content Pipeline, 集成在XNA Game Studio中, 通过属性面板的方式, 设置各个参数. 如下图所示:其中Mipmaps和Resize to Power of two在">
<meta name="keywords" content="编程">
<meta property="og:type" content="article">
<meta property="og:title" content="MonoGame笔记(十二)Content Pipeline介绍">
<meta property="og:url" content="http://yoursite.com/2017/12/19/MonoGame笔记(十二)Content Pipeline/index.html">
<meta property="og:site_name" content="远">
<meta property="og:description" content="游戏中除了代码就是资源. 代码本身也是一种资源(Unity3D中代码和资源都被组织在Asset目录下). Unity3D属于All in One, Flash有强大的Flash CS编辑资源, 而XNA也有Content Pipeline, 集成在XNA Game Studio中, 通过属性面板的方式, 设置各个参数. 如下图所示:其中Mipmaps和Resize to Power of two在">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-panel.png">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-process.png">
<meta property="og:image" content="http://yoursite.com/img/monogame-contentpipeline-process-detail.png">
<meta property="og:updated_time" content="2017-12-19T07:05:03.537Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MonoGame笔记(十二)Content Pipeline介绍">
<meta name="twitter:description" content="游戏中除了代码就是资源. 代码本身也是一种资源(Unity3D中代码和资源都被组织在Asset目录下). Unity3D属于All in One, Flash有强大的Flash CS编辑资源, 而XNA也有Content Pipeline, 集成在XNA Game Studio中, 通过属性面板的方式, 设置各个参数. 如下图所示:其中Mipmaps和Resize to Power of two在">
<meta name="twitter:image" content="http://yoursite.com/img/monogame-contentpipeline-panel.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/12/19/MonoGame笔记(十二)Content Pipeline/">





  <title>MonoGame笔记(十二)Content Pipeline介绍 | 远</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">远</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/19/MonoGame笔记(十二)Content Pipeline/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="zmapleaf">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="远">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MonoGame笔记(十二)Content Pipeline介绍</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-19T13:29:37+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>游戏中除了代码就是资源. 代码本身也是一种资源(Unity3D中代码和资源都被组织在Asset目录下). Unity3D属于All in One, Flash有强大的Flash CS编辑资源, 而XNA也有Content Pipeline, 集成在XNA Game Studio中, 通过属性面板的方式, 设置各个参数. 如下图所示:<br><img src="/img/monogame-contentpipeline-panel.png" alt=""><br>其中Mipmaps和Resize to Power of two在Unity3D中对Sprite进行设置时也有</p>
<p>使用Content Pipeline的好处是什么?官方介绍如下: <a href="https://msdn.microsoft.com/en-us/library/bb447756.aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/bb447756.aspx</a></p>
<p>The <strong>chief</strong> reason XNA Game Studio uses a Content Pipeline is to help your game run fast. Without the content pipeline, your game would have to be built with its art assets in their original file format. When the game needs to load its art to draw it on the screen, it would have to determine its format and convert the data into a form it can use more directly. This would have to be performed at run time, for each asset, making the player wait to have fun.</p>
<p>The Content Pipeline remedies this by shifting this time-consuming work to when the game is built. At build time, each asset is imported from its original file format and processed into a managed code object. Those objects are then serialized to a file that is included in the game’s executable.</p>
<p>At run time, the game can then read the serialized data from the file directly into a managed code object for immediate use.</p>
<p>从分工上:</p>
<p>The Content Pipeline is designed to help you include such art assets in your game easily and automatically. An artist working on a a car model can add the resulting file to the XNA Game Studio Express game project, assign the model a name, and choose an importer and content processor for it. Then, a developer who wants to make the car drive can load it by name using a call to ContentManager.Load. This simple flow lets the artist focus on creating assets and the developer focus on using them, without either having to spend time worrying about content transformation.实际上程序员还是要花不少时间在处理资源上, 尤其是重新排列资源的组织方式</p>
<p>下图是Content Pipeline处理过程(<a href="https://msdn.microsoft.com/en-us/library/bb447745.aspx" target="_blank" rel="noopener">https://msdn.microsoft.com/en-us/library/bb447745.aspx</a>)<br><img src="/img/monogame-contentpipeline-process.png" alt=""><br>其中Importer和Content Processor属于Design-Time Components, Content Loader属于Runtime Components. </p>
<p>Importer将资源导入到XNA Game Studio中, 以Texture为例, 它的作用是对各类图像格式去差异化, 生成一个统一的Texture对象, 供Processor去处理.</p>
<p>Processor对Importer生成的资源对象进行处理, 以Texture为例, 生成Mipmap等等</p>
<p>Design-Time是指在属性面板中选择合适的Content Importer和Content Processor, 然后build, 生成xnb二进制文件.该文件可以在运行时被加载. 资源源文件不需要和游戏一起发布.Runtime是指游戏运行时. 上图中的Intermediate Format是指.xnb文件. </p>
<p>上图还缺少两个东西: 序列化和反序列化. 前者用于将Content Processor输出的内容序列化成xnb二进制文件, 后者将xnb文件反序列化成相应的对象. 序列化器属于Design-Time, 反序列化器属于RunTime, 体现在代码上就是二者所属的命名空间不同, 前者是namespace Microsoft.Xna.Framework.Content.Pipeline, 后者是namespace Microsoft.Xna.Framework</p>
<p>更详细的过程如下图所示:<a href="https://msdn.microsoft.com/zh-cn/library/bb447745(v=xnagamestudio.10)" target="_blank" rel="noopener">https://msdn.microsoft.com/zh-cn/library/bb447745(v=xnagamestudio.10)</a><br><img src="/img/monogame-contentpipeline-process-detail.png" alt=""></p>
<p>Content Pipeline还可以进行自定义和扩展, 以支持新的资源格式, 或者对原有的Content Processor进行增强. 关于自定义和扩展, 官方的一个概略性介绍如下:</p>
<ul>
<li>XNA Game Studio Express supplies standard importers and processors for a number of popular DCC file formats (see Standard Importers and Processors).</li>
<li>Third parties also create custom importers and processors for XNA Game Studio Express to support additional formats.</li>
<li>If you have enough information about a DCC file format, you can write your own custom importer and processor for it using classes provided by the Content Pipeline class library (see Writing a Custom Importer).</li>
<li>When you include an art asset file in your XNA Game Studio Express game project, you use its Properties sheet to specify the importer and processor that is appropriate to it. Thereafter, when you press F5 to build your game, the proper importer and processor for each asset is automatically invoked, and the asset is built into your game in a form that can be loaded at run time on Windows or the Xbox 360 by using <strong>ContentManager.Load</strong>. ContentManager.Load会寻找合适的ContentTypeReader, 将xnb文件反序列化成对象, 例如Texture2D, SpriteFont等</li>
</ul>
<p>进一步的自定义和扩展介绍, 见后面的笔记.</p>
<p>以最常用的Texture2D为例, 看看各个组成部分到底是什么样子.</p>
<h4 id="Importer"><a href="#Importer" class="headerlink" title="Importer"></a>Importer</h4><p>Importer加载各种图像原文件, 生成一个统一的TextureContent供Processor使用.<br>不同的图像格式, 有些是RGBA, 有些是BGRA等等, 去差异化<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Graphics;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Content.Pipeline.Graphics;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Graphics.PackedVector;</span><br><span class="line"><span class="keyword">using</span> FreeImageAPI;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Provides methods for reading texture files for use in the Content Pipeline.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Texture支持大部分常用的图片格式</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    [<span class="meta">ContentImporter(<span class="meta-string">".bmp"</span>, // Bitmap Image File</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".cut"</span>, // Dr Halo CUT</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".dds"</span>, // Direct Draw Surface</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".g3"</span>, // Raw Fax G3</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".hdr"</span>, // RGBE</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".gif"</span>, // Graphcis Interchange Format</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".ico"</span>, // Microsoft Windows Icon</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".iff"</span>, // Interchange File Format</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".jbg"</span>, <span class="meta-string">".jbig"</span>, // JBIG</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".jng"</span>, <span class="meta-string">".jpg"</span>, <span class="meta-string">".jpeg"</span>, <span class="meta-string">".jpe"</span>, <span class="meta-string">".jif"</span>, <span class="meta-string">".jfif"</span>, <span class="meta-string">".jfi"</span>, // JPEG</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".jp2"</span>, <span class="meta-string">".j2k"</span>, <span class="meta-string">".jpf"</span>, <span class="meta-string">".jpx"</span>, <span class="meta-string">".jpm"</span>, <span class="meta-string">".mj2"</span>, // JPEG 2000</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".jxr"</span>, <span class="meta-string">".hdp"</span>, <span class="meta-string">".wdp"</span>, // JPEG XR</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".koa"</span>, <span class="meta-string">".gg"</span>, // Koala</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".pcd"</span>, // Kodak PhotoCD</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".mng"</span>, // Multiple-Image Network Graphics</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".pcx"</span>, //Personal Computer Exchange</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".pbm"</span>, <span class="meta-string">".pgm"</span>, <span class="meta-string">".ppm"</span>, <span class="meta-string">".pnm"</span>, // Netpbm</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".pfm"</span>, // Printer Font Metrics</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".png"</span>, //Portable Network Graphics</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".pict"</span>, <span class="meta-string">".pct"</span>, <span class="meta-string">".pic"</span>, // PICT</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".psd"</span>, // Photoshop</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".3fr"</span>, <span class="meta-string">".ari"</span>, <span class="meta-string">".arw"</span>, <span class="meta-string">".bay"</span>, <span class="meta-string">".crw"</span>, <span class="meta-string">".cr2"</span>, <span class="meta-string">".cap"</span>, <span class="meta-string">".dcs"</span>, // RAW</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".dcr"</span>, <span class="meta-string">".dng"</span>, <span class="meta-string">".drf"</span>, <span class="meta-string">".eip"</span>, <span class="meta-string">".erf"</span>, <span class="meta-string">".fff"</span>, <span class="meta-string">".iiq"</span>, <span class="meta-string">".k25"</span>, // RAW</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".kdc"</span>, <span class="meta-string">".mdc"</span>, <span class="meta-string">".mef"</span>, <span class="meta-string">".mos"</span>, <span class="meta-string">".mrw"</span>, <span class="meta-string">".nef"</span>, <span class="meta-string">".nrw"</span>, <span class="meta-string">".obm"</span>, // RAW</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".orf"</span>, <span class="meta-string">".pef"</span>, <span class="meta-string">".ptx"</span>, <span class="meta-string">".pxn"</span>, <span class="meta-string">".r3d"</span>, <span class="meta-string">".raf"</span>, <span class="meta-string">".raw"</span>, <span class="meta-string">".rwl"</span>, // RAW</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".rw2"</span>, <span class="meta-string">".rwz"</span>, <span class="meta-string">".sr2"</span>, <span class="meta-string">".srf"</span>, <span class="meta-string">".srw"</span>, <span class="meta-string">".x3f"</span>, // RAW</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".ras"</span>, <span class="meta-string">".sun"</span>, // Sun RAS</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".sgi"</span>, <span class="meta-string">".rgba"</span>, <span class="meta-string">".bw"</span>, <span class="meta-string">".int"</span>, <span class="meta-string">".inta"</span>, // Silicon Graphics Image</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".tga"</span>, // Truevision TGA/TARGA</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".tiff"</span>, <span class="meta-string">".tif"</span>, // Tagged Image File Format</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".wbmp"</span>, // Wireless Application Protocol Bitmap Format</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".webp"</span>, // WebP</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".xbm"</span>, // X BitMap</span></span><br><span class="line"><span class="meta">                        <span class="meta-string">".xpm"</span>, // X PixMap</span></span><br><span class="line"><span class="meta">                    DisplayName = <span class="meta-string">"Texture Importer - MonoGame"</span>, DefaultProcessor = <span class="meta-string">"TextureProcessor"</span>)</span>]</span><br><span class="line">    public class TextureImporter : ContentImporter&lt;TextureContent&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Initializes a new instance of TextureImporter.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TextureImporter</span>(<span class="params"> </span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Called by the XNA Framework when importing a texture file to be used as a game asset. This is the method called by the XNA Framework when an asset is to be imported into an object that can be recognized by the Content Pipeline.该方法是被XNA Framework调用的. FreeImage是一个第三方图像库</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="filename"&gt;</span>Name of a game asset file.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="context"&gt;</span>Contains information for importing a game asset, such as a logger interface.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>Resulting game asset.<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> TextureContent <span class="title">Import</span>(<span class="params"><span class="keyword">string</span> filename, ContentImporterContext context</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// Special case for loading DDS</span></span><br><span class="line">            <span class="keyword">if</span> (filename.ToLower().EndsWith(<span class="string">".dds"</span>))</span><br><span class="line">                <span class="keyword">return</span> DdsLoader.Import(filename, context);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> output = <span class="keyword">new</span> Texture2DContent &#123; Identity = <span class="keyword">new</span> ContentIdentity(filename) &#125;;</span><br><span class="line"></span><br><span class="line">            FREE_IMAGE_FORMAT format = FREE_IMAGE_FORMAT.FIF_UNKNOWN;</span><br><span class="line">            <span class="keyword">var</span> fBitmap = FreeImage.LoadEx(filename, FREE_IMAGE_LOAD_FLAGS.DEFAULT, <span class="keyword">ref</span> format);</span><br><span class="line">            <span class="comment">//if freeimage can not recognize the image type</span></span><br><span class="line">            <span class="keyword">if</span>(format == FREE_IMAGE_FORMAT.FIF_UNKNOWN)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ContentLoadException(<span class="string">"TextureImporter failed to load '"</span> + filename + <span class="string">"'"</span>);</span><br><span class="line">            <span class="comment">//if freeimage can recognize the file headers but can't read its contents</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(fBitmap.IsNull)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidContentException(<span class="string">"TextureImporter couldn't understand the contents of '"</span> + filename + <span class="string">"'"</span>, output.Identity);</span><br><span class="line">            BitmapContent face = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">var</span> height = (<span class="keyword">int</span>) FreeImage.GetHeight(fBitmap);</span><br><span class="line">            <span class="keyword">var</span> width = (<span class="keyword">int</span>) FreeImage.GetWidth(fBitmap);</span><br><span class="line">            <span class="comment">//uint bpp = FreeImage.GetBPP(fBitmap);</span></span><br><span class="line">            <span class="keyword">var</span> imageType = FreeImage.GetImageType(fBitmap);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Swizzle channels and expand to include an alpha channel</span></span><br><span class="line">            fBitmap = ConvertAndSwapChannels(fBitmap, imageType);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// The bits per pixel and image type may have changed</span></span><br><span class="line">            <span class="keyword">uint</span> bpp = FreeImage.GetBPP(fBitmap);</span><br><span class="line">            imageType = FreeImage.GetImageType(fBitmap);</span><br><span class="line">            <span class="keyword">var</span> pitch = (<span class="keyword">int</span>) FreeImage.GetPitch(fBitmap);</span><br><span class="line">            <span class="keyword">var</span> redMask = FreeImage.GetRedMask(fBitmap);</span><br><span class="line">            <span class="keyword">var</span> greenMask = FreeImage.GetGreenMask(fBitmap);</span><br><span class="line">            <span class="keyword">var</span> blueMask = FreeImage.GetBlueMask(fBitmap);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create the byte array for the data</span></span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[((width * height * bpp - <span class="number">1</span>) / <span class="number">8</span>) + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Converts the pixel data to bytes, do not try to use this call to switch the color channels because that only works for 16bpp bitmaps</span></span><br><span class="line">            FreeImage.ConvertToRawBits(bytes, fBitmap, pitch, bpp, redMask, greenMask, blueMask, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// Create the Pixel bitmap content depending on the image type</span></span><br><span class="line">            <span class="keyword">switch</span>(imageType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//case FREE_IMAGE_TYPE.FIT_BITMAP:</span></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    face = <span class="keyword">new</span> PixelBitmapContent&lt;Color&gt;(width, height);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> FREE_IMAGE_TYPE.FIT_RGBA16:</span><br><span class="line">                    face = <span class="keyword">new</span> PixelBitmapContent&lt;Rgba64&gt;(width, height);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> FREE_IMAGE_TYPE.FIT_RGBAF:</span><br><span class="line">                    face = <span class="keyword">new</span> PixelBitmapContent&lt;Vector4&gt;(width, height);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            FreeImage.UnloadEx(<span class="keyword">ref</span> fBitmap);</span><br><span class="line"></span><br><span class="line">            face.SetPixelData(bytes);</span><br><span class="line">            output.Faces[<span class="number">0</span>].Add(face);</span><br><span class="line">            <span class="keyword">return</span> output;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Expands images to have an alpha channel and swaps red and blue channels</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="fBitmap"&gt;</span>Image to process<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="imageType"&gt;</span>Type of the image for the procedure<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> FIBITMAP <span class="title">ConvertAndSwapChannels</span>(<span class="params">FIBITMAP fBitmap, FREE_IMAGE_TYPE imageType</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            FIBITMAP bgra;</span><br><span class="line">            <span class="keyword">switch</span>(imageType)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// RGBF are switched before adding an alpha channel.</span></span><br><span class="line">                <span class="keyword">case</span> FREE_IMAGE_TYPE.FIT_RGBF:</span><br><span class="line">                    <span class="comment">// Swap R and B channels to make it BGR, then add an alpha channel</span></span><br><span class="line">                    SwitchRedAndBlueChannels(fBitmap);</span><br><span class="line">                    bgra = FreeImage.ConvertToType(fBitmap, FREE_IMAGE_TYPE.FIT_RGBAF, <span class="literal">true</span>);</span><br><span class="line">                    FreeImage.UnloadEx(<span class="keyword">ref</span> fBitmap);</span><br><span class="line">                    fBitmap = bgra;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> FREE_IMAGE_TYPE.FIT_RGB16:</span><br><span class="line">                    <span class="comment">// Swap R and B channels to make it BGR, then add an alpha channel</span></span><br><span class="line">                    SwitchRedAndBlueChannels(fBitmap);</span><br><span class="line">                    bgra = FreeImage.ConvertToType(fBitmap, FREE_IMAGE_TYPE.FIT_RGBA16, <span class="literal">true</span>);</span><br><span class="line">                    FreeImage.UnloadEx(<span class="keyword">ref</span> fBitmap);</span><br><span class="line">                    fBitmap = bgra;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> FREE_IMAGE_TYPE.FIT_RGBAF:</span><br><span class="line">                <span class="keyword">case</span> FREE_IMAGE_TYPE.FIT_RGBA16:</span><br><span class="line">                    <span class="comment">//Don't switch channels in this case or colors will be shown wrong</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="comment">// Bitmap and other formats are converted to 32-bit by default</span></span><br><span class="line">                    bgra = FreeImage.ConvertTo32Bits(fBitmap);</span><br><span class="line">                    SwitchRedAndBlueChannels(bgra);</span><br><span class="line">                    FreeImage.UnloadEx(<span class="keyword">ref</span> fBitmap);</span><br><span class="line">                    fBitmap = bgra;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> fBitmap;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Switches the red and blue channels</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="fBitmap"&gt;</span>image<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SwitchRedAndBlueChannels</span>(<span class="params">FIBITMAP fBitmap</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> r = FreeImage.GetChannel(fBitmap, FREE_IMAGE_COLOR_CHANNEL.FICC_RED);</span><br><span class="line">            <span class="keyword">var</span> b = FreeImage.GetChannel(fBitmap, FREE_IMAGE_COLOR_CHANNEL.FICC_BLUE);</span><br><span class="line">            FreeImage.SetChannel(fBitmap, b, FREE_IMAGE_COLOR_CHANNEL.FICC_RED);</span><br><span class="line">            FreeImage.SetChannel(fBitmap, r, FREE_IMAGE_COLOR_CHANNEL.FICC_BLUE);</span><br><span class="line">            FreeImage.UnloadEx(<span class="keyword">ref</span> r);</span><br><span class="line">            FreeImage.UnloadEx(<span class="keyword">ref</span> b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="TextureProcessor"><a href="#TextureProcessor" class="headerlink" title="TextureProcessor"></a>TextureProcessor</h4><p>Processor中的Public属性会显示在属性面板上<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.ComponentModel;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Content.Pipeline.Graphics;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Graphics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline.Processors</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ContentProcessor(DisplayName=<span class="meta-string">"Texture - MonoGame"</span>)</span>]</span><br><span class="line">    public class TextureProcessor : ContentProcessor&lt;TextureContent, TextureContent&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TextureProcessor</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            ColorKeyColor = <span class="keyword">new</span> Color(<span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">            ColorKeyEnabled = <span class="literal">true</span>;</span><br><span class="line">            PremultiplyAlpha = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DefaultValueAttribute(typeof(Color), <span class="meta-string">"255,0,255,255"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> Color ColorKeyColor &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DefaultValueAttribute(true)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">bool</span> ColorKeyEnabled &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">bool</span> GenerateMipmaps &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DefaultValueAttribute(true)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">bool</span> PremultiplyAlpha &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">bool</span> ResizeToPowerOfTwo &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">bool</span> MakeSquare &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> TextureProcessorOutputFormat TextureFormat &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> TextureContent <span class="title">Process</span>(<span class="params">TextureContent input, ContentProcessorContext context</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            SurfaceFormat format;</span><br><span class="line">            <span class="keyword">if</span> (input.Faces[<span class="number">0</span>][<span class="number">0</span>].TryGetFormat(<span class="keyword">out</span> format))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// If it is already a compressed format, we cannot do anything else so just return it</span></span><br><span class="line">                <span class="keyword">if</span> (format.IsCompressedFormat())</span><br><span class="line">                    <span class="keyword">return</span> input;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ColorKeyEnabled || ResizeToPowerOfTwo || MakeSquare || PremultiplyAlpha)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Convert to floating point format for modifications. Keep the original format for conversion back later on if required.</span></span><br><span class="line">                <span class="keyword">var</span> originalType = input.Faces[<span class="number">0</span>][<span class="number">0</span>].GetType();</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    input.ConvertBitmapType(<span class="keyword">typeof</span>(PixelBitmapContent&lt;Vector4&gt;));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">                &#123;</span><br><span class="line">                    context.Logger.LogImportantMessage(<span class="string">"Could not convert input texture for processing. "</span> + ex.ToString());</span><br><span class="line">                    <span class="keyword">throw</span> ex; </span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> f = <span class="number">0</span>; f &lt; input.Faces.Count; ++f)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> face = input.Faces[f];</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">0</span>; m &lt; face.Count; ++m)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">var</span> bmp = (PixelBitmapContent&lt;Vector4&gt;)face[m];</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (ColorKeyEnabled)</span><br><span class="line">                        &#123;</span><br><span class="line">                            bmp.ReplaceColor(ColorKeyColor.ToVector4(), Vector4.Zero);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (ResizeToPowerOfTwo)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!GraphicsUtil.IsPowerOfTwo(bmp.Width) || !GraphicsUtil.IsPowerOfTwo(bmp.Height) || (MakeSquare &amp;&amp; bmp.Height != bmp.Width))</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">var</span> newWidth = GraphicsUtil.GetNextPowerOfTwo(bmp.Width);</span><br><span class="line">                                <span class="keyword">var</span> newHeight = GraphicsUtil.GetNextPowerOfTwo(bmp.Height);</span><br><span class="line">                                <span class="keyword">if</span> (MakeSquare)</span><br><span class="line">                                    newWidth = newHeight = Math.Max(newWidth, newHeight);</span><br><span class="line">                                <span class="keyword">var</span> resized = <span class="keyword">new</span> PixelBitmapContent&lt;Vector4&gt;(newWidth, newHeight);</span><br><span class="line">                                BitmapContent.Copy(bmp, resized);</span><br><span class="line">                                bmp = resized;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (MakeSquare &amp;&amp; bmp.Height != bmp.Width)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">var</span> newSize = Math.Max(bmp.Width, bmp.Height);</span><br><span class="line">                            <span class="keyword">var</span> resized = <span class="keyword">new</span> PixelBitmapContent&lt;Vector4&gt;(newSize, newSize);</span><br><span class="line">                            BitmapContent.Copy(bmp, resized);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (PremultiplyAlpha)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; bmp.Height; ++y)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">var</span> row = bmp.GetRow(y);</span><br><span class="line">                                <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; bmp.Width; ++x)</span><br><span class="line">                                    row[x] = Color.FromNonPremultiplied(row[x]).ToVector4();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        face[m] = bmp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// If no change to the surface format was desired, change it back now before it early outs</span></span><br><span class="line">                <span class="keyword">if</span> (TextureFormat == TextureProcessorOutputFormat.NoChange)</span><br><span class="line">                    input.ConvertBitmapType(originalType);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Get the texture profile for the platform and let it convert the texture.</span></span><br><span class="line">            <span class="keyword">var</span> texProfile = TextureProfile.ForPlatform(context.TargetPlatform);</span><br><span class="line">            texProfile.ConvertTexture(context, input, TextureFormat, GenerateMipmaps, <span class="literal">false</span>);	</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> input;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><p>注意它所属的命名空间. Serialization下面除了Compiler, 还有一个Serializer, 二者之间的差异见后面的笔记<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Content.Pipeline.Graphics;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Graphics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline.Serialization.Compiler</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">ContentTypeWriter</span>]</span><br><span class="line">    class Texture2DWriter : BuiltInContentWriter&lt;Texture2DContent&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">internal</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Write</span>(<span class="params">ContentWriter output, Texture2DContent <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">var</span> mipmaps = <span class="keyword">value</span>.Faces[<span class="number">0</span>];   <span class="comment">// Mipmap chain.</span></span><br><span class="line">            <span class="keyword">var</span> level0 = mipmaps[<span class="number">0</span>];        <span class="comment">// Most detailed mipmap level.</span></span><br><span class="line"></span><br><span class="line">            SurfaceFormat format;</span><br><span class="line">            <span class="keyword">if</span> (!level0.TryGetFormat(<span class="keyword">out</span> format))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"Couldn't get Format for TextureContent."</span>);</span><br><span class="line"></span><br><span class="line">            output.Write((<span class="keyword">int</span>)format);</span><br><span class="line">            output.Write(level0.Width);</span><br><span class="line">            output.Write(level0.Height);</span><br><span class="line">            output.Write(mipmaps.Count);    <span class="comment">// Number of mipmap levels.</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> level <span class="keyword">in</span> mipmaps)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> pixelData = level.GetPixelData();</span><br><span class="line">                output.Write(pixelData.Length);</span><br><span class="line">                output.Write(pixelData);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><p>注意该类的位置是在framework中, 不在content pipeline中,<br>因为该类是运行时用到的<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Content;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Graphics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content</span></span><br><span class="line">&#123;</span><br><span class="line">    internal class Texture2DReader : ContentTypeReader&lt;Texture2D&gt;</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="function"><span class="keyword">internal</span> <span class="title">Texture2DReader</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			<span class="comment">// Do nothing</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">internal</span> <span class="keyword">override</span> Texture2D <span class="title">Read</span>(<span class="params">ContentReader reader, Texture2D existingInstance</span>)</span></span><br><span class="line"><span class="function"></span>		&#123;</span><br><span class="line">			Texture2D texture = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> surfaceFormat = (SurfaceFormat)reader.ReadInt32();</span><br><span class="line">            <span class="keyword">int</span> width = reader.ReadInt32();</span><br><span class="line">            <span class="keyword">int</span> height = reader.ReadInt32();</span><br><span class="line">            <span class="keyword">int</span> levelCount = reader.ReadInt32();</span><br><span class="line">            <span class="keyword">int</span> levelCountOutput = levelCount;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If the system does not fully support Power of Two textures,</span></span><br><span class="line">            <span class="comment">// skip any mip maps supplied with any non PoT textures.</span></span><br><span class="line">            <span class="keyword">if</span> (levelCount &gt; <span class="number">1</span> &amp;&amp; !reader.GraphicsDevice.GraphicsCapabilities.SupportsNonPowerOfTwo &amp;&amp;</span><br><span class="line">                (!MathHelper.IsPowerOfTwo(width) || !MathHelper.IsPowerOfTwo(height)))</span><br><span class="line">            &#123;</span><br><span class="line">                levelCountOutput = <span class="number">1</span>;</span><br><span class="line">                System.Diagnostics.Debug.WriteLine(</span><br><span class="line">                    <span class="string">"Device does not support non Power of Two textures. Skipping mipmaps."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">			SurfaceFormat convertedFormat = surfaceFormat;</span><br><span class="line">			<span class="keyword">switch</span> (surfaceFormat)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.Dxt1:</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.Dxt1a:</span><br><span class="line">					<span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsDxt1)</span><br><span class="line">						convertedFormat = SurfaceFormat.Color;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.Dxt1SRgb:</span><br><span class="line">					<span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsDxt1)</span><br><span class="line">						convertedFormat = SurfaceFormat.ColorSRgb;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.Dxt3:</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.Dxt5:</span><br><span class="line">					<span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsS3tc)</span><br><span class="line">						convertedFormat = SurfaceFormat.Color;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.Dxt3SRgb:</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.Dxt5SRgb:</span><br><span class="line">					<span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsS3tc)</span><br><span class="line">						convertedFormat = SurfaceFormat.ColorSRgb;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> SurfaceFormat.NormalizedByte4:</span><br><span class="line">					convertedFormat = SurfaceFormat.Color;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">            texture = existingInstance ?? <span class="keyword">new</span> Texture2D(reader.GraphicsDevice, width, height, levelCountOutput &gt; <span class="number">1</span>, convertedFormat);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> OPENGL</span></span><br><span class="line">            Threading.BlockOnUIThread(() =&gt;</span><br><span class="line">            &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> level = <span class="number">0</span>; level &lt; levelCount; level++)</span><br><span class="line">			    &#123;</span><br><span class="line">				    <span class="keyword">var</span> levelDataSizeInBytes = reader.ReadInt32();</span><br><span class="line">                    <span class="keyword">var</span> levelData = reader.ContentManager.GetScratchBuffer(levelDataSizeInBytes);</span><br><span class="line">                    reader.Read(levelData, <span class="number">0</span>, levelDataSizeInBytes);</span><br><span class="line">                    <span class="keyword">int</span> levelWidth = width &gt;&gt; level;</span><br><span class="line">                    <span class="keyword">int</span> levelHeight = height &gt;&gt; level;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (level &gt;= levelCountOutput)</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">				    <span class="comment">//Convert the image data if required</span></span><br><span class="line">				    <span class="keyword">switch</span> (surfaceFormat)</span><br><span class="line">				    &#123;</span><br><span class="line">					    <span class="keyword">case</span> SurfaceFormat.Dxt1:</span><br><span class="line">                        <span class="keyword">case</span> SurfaceFormat.Dxt1SRgb:</span><br><span class="line">                        <span class="keyword">case</span> SurfaceFormat.Dxt1a:</span><br><span class="line">                            <span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsDxt1 &amp;&amp; convertedFormat == SurfaceFormat.Color)</span><br><span class="line">						        levelData = DxtUtil.DecompressDxt1(levelData, levelWidth, levelHeight);</span><br><span class="line">						    <span class="keyword">break</span>;</span><br><span class="line">					    <span class="keyword">case</span> SurfaceFormat.Dxt3:</span><br><span class="line">					    <span class="keyword">case</span> SurfaceFormat.Dxt3SRgb:</span><br><span class="line">                            <span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsS3tc)</span><br><span class="line">                            <span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsS3tc &amp;&amp; convertedFormat == SurfaceFormat.Color)</span><br><span class="line">						        levelData = DxtUtil.DecompressDxt3(levelData, levelWidth, levelHeight);</span><br><span class="line">						    <span class="keyword">break</span>;</span><br><span class="line">					    <span class="keyword">case</span> SurfaceFormat.Dxt5:</span><br><span class="line">					    <span class="keyword">case</span> SurfaceFormat.Dxt5SRgb:</span><br><span class="line">                            <span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsS3tc)</span><br><span class="line">                            <span class="keyword">if</span> (!reader.GraphicsDevice.GraphicsCapabilities.SupportsS3tc &amp;&amp; convertedFormat == SurfaceFormat.Color)</span><br><span class="line">    						    levelData = DxtUtil.DecompressDxt5(levelData, levelWidth, levelHeight);</span><br><span class="line">						    <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> SurfaceFormat.Bgra5551:</span><br><span class="line">                            &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> OPENGL</span></span><br><span class="line">                                <span class="comment">// Shift the channels to suit OpenGL</span></span><br><span class="line">                                <span class="keyword">int</span> offset = <span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; levelHeight; y++)</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; levelWidth; x++)</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="keyword">ushort</span> pixel = BitConverter.ToUInt16(levelData, offset);</span><br><span class="line">                                        pixel = (<span class="keyword">ushort</span>)(((pixel &amp; <span class="number">0x7FFF</span>) &lt;&lt; <span class="number">1</span>) | ((pixel &amp; <span class="number">0x8000</span>) &gt;&gt; <span class="number">15</span>));</span><br><span class="line">                                        levelData[offset] = (<span class="keyword">byte</span>)(pixel);</span><br><span class="line">                                        levelData[offset + <span class="number">1</span>] = (<span class="keyword">byte</span>)(pixel &gt;&gt; <span class="number">8</span>);</span><br><span class="line">                                        offset += <span class="number">2</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">					    <span class="keyword">case</span> SurfaceFormat.Bgra4444:</span><br><span class="line">						    &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> OPENGL</span></span><br><span class="line">                                <span class="comment">// Shift the channels to suit OpenGL</span></span><br><span class="line">							    <span class="keyword">int</span> offset = <span class="number">0</span>;</span><br><span class="line">							    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; levelHeight; y++)</span><br><span class="line">							    &#123;</span><br><span class="line">								    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; levelWidth; x++)</span><br><span class="line">								    &#123;</span><br><span class="line">									    <span class="keyword">ushort</span> pixel = BitConverter.ToUInt16(levelData, offset);</span><br><span class="line">									    pixel = (<span class="keyword">ushort</span>)(((pixel &amp; <span class="number">0x0FFF</span>) &lt;&lt; <span class="number">4</span>) | ((pixel &amp; <span class="number">0xF000</span>) &gt;&gt; <span class="number">12</span>));</span><br><span class="line">									    levelData[offset] = (<span class="keyword">byte</span>)(pixel);</span><br><span class="line">									    levelData[offset + <span class="number">1</span>] = (<span class="keyword">byte</span>)(pixel &gt;&gt; <span class="number">8</span>);</span><br><span class="line">									    offset += <span class="number">2</span>;</span><br><span class="line">								    &#125;</span><br><span class="line">							    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">						    &#125;</span><br><span class="line">						    <span class="keyword">break</span>;</span><br><span class="line">					    <span class="keyword">case</span> SurfaceFormat.NormalizedByte4:</span><br><span class="line">						    &#123;</span><br><span class="line">							    <span class="keyword">int</span> bytesPerPixel = surfaceFormat.GetSize();</span><br><span class="line">							    <span class="keyword">int</span> pitch = levelWidth * bytesPerPixel;</span><br><span class="line">							    <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; levelHeight; y++)</span><br><span class="line">							    &#123;</span><br><span class="line">								    <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; levelWidth; x++)</span><br><span class="line">								    &#123;</span><br><span class="line">									    <span class="keyword">int</span> color = BitConverter.ToInt32(levelData, y * pitch + x * bytesPerPixel);</span><br><span class="line">									    levelData[y * pitch + x * <span class="number">4</span>] = (<span class="keyword">byte</span>)(((color &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>)); <span class="comment">//R:=W</span></span><br><span class="line">									    levelData[y * pitch + x * <span class="number">4</span> + <span class="number">1</span>] = (<span class="keyword">byte</span>)(((color &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>)); <span class="comment">//G:=V</span></span><br><span class="line">									    levelData[y * pitch + x * <span class="number">4</span> + <span class="number">2</span>] = (<span class="keyword">byte</span>)(((color) &amp; <span class="number">0xff</span>)); <span class="comment">//B:=U</span></span><br><span class="line">									    levelData[y * pitch + x * <span class="number">4</span> + <span class="number">3</span>] = (<span class="keyword">byte</span>)(((color &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>)); <span class="comment">//A:=Q</span></span><br><span class="line">								    &#125;</span><br><span class="line">							    &#125;</span><br><span class="line">						    &#125;</span><br><span class="line">						    <span class="keyword">break</span>;</span><br><span class="line">				    &#125;</span><br><span class="line">				</span><br><span class="line">                    texture.SetData(level, <span class="literal">null</span>, levelData, <span class="number">0</span>, levelDataSizeInBytes);</span><br><span class="line">			    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> OPENGL</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        			</span><br><span class="line">			<span class="keyword">return</span> texture;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="TextureContent"><a href="#TextureContent" class="headerlink" title="TextureContent"></a>TextureContent</h4><p>XNA Game Studio Content Document Object Model (DOM) 这个统一各个图像格式的TextureContent是什么样子, 里面的Faces用于mipmap<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MonoGame - Copyright (C) The MonoGame Team</span></span><br><span class="line"><span class="comment">// This file is subject to the terms and conditions defined in</span></span><br><span class="line"><span class="comment">// file 'LICENSE.txt', which is part of this source code package.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Xna.Framework.Graphics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.Xna.Framework.Content.Pipeline.Graphics</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Provides a base class for all texture objects.</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">TextureContent</span> : <span class="title">ContentItem</span></span><br><span class="line">    &#123;</span><br><span class="line">        MipmapChainCollection faces;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Collection of image faces that hold a single mipmap chain for a regular 2D texture, six chains for a cube map, or an arbitrary number for volume and array textures.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> MipmapChainCollection Faces</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> faces;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Initializes a new instance of TextureContent with the specified face collection.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="faces"&gt;</span>Mipmap chain containing the face collection.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="title">TextureContent</span>(<span class="params">MipmapChainCollection faces</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.faces = faces;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Converts all bitmaps for this texture to a different format.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="newBitmapType"&gt;</span>Type being converted to. The new type must be a subclass of BitmapContent, such as PixelBitmapContent or DxtBitmapContent.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConvertBitmapType</span>(<span class="params">Type newBitmapType</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">if</span> (newBitmapType == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"newBitmapType"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!newBitmapType.IsSubclassOf(<span class="keyword">typeof</span> (BitmapContent)))</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="keyword">string</span>.Format(<span class="string">"Type '&#123;0&#125;' is not a subclass of BitmapContent."</span>, newBitmapType));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (newBitmapType.IsAbstract)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="keyword">string</span>.Format(<span class="string">"Type '&#123;0&#125;' is abstract and cannot be allocated."</span>, newBitmapType));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (newBitmapType.ContainsGenericParameters)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="keyword">string</span>.Format(<span class="string">"Type '&#123;0&#125;' contains generic parameters and cannot be allocated."</span>, newBitmapType));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (newBitmapType.GetConstructor(<span class="keyword">new</span> Type[<span class="number">2</span>] &#123;<span class="keyword">typeof</span> (<span class="keyword">int</span>), <span class="keyword">typeof</span> (<span class="keyword">int</span>)&#125;) == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="keyword">string</span>.Format(<span class="string">"Type '&#123;0&#125; does not have a constructor with signature (int, int) and cannot be allocated."</span>,</span><br><span class="line">                                                          newBitmapType));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> mipChain <span class="keyword">in</span> faces)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; mipChain.Count; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> src = mipChain[i];</span><br><span class="line">                    <span class="keyword">if</span> (src.GetType() != newBitmapType)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">var</span> dst = (BitmapContent)Activator.CreateInstance(newBitmapType, <span class="keyword">new</span> <span class="keyword">object</span>[] &#123; src.Width,src.Height &#125;);</span><br><span class="line">                        BitmapContent.Copy(src, dst);</span><br><span class="line">                        mipChain[i] = dst;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;        </span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Generates a full set of mipmaps for the texture.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="overwriteExistingMipmaps"&gt;</span>true if the existing mipmap set is replaced with the new set; false otherwise.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">GenerateMipmaps</span>(<span class="params"><span class="keyword">bool</span> overwriteExistingMipmaps</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">// If we already have mipmaps and we're not supposed to overwrite</span></span><br><span class="line">            <span class="comment">// them then return without any generation.</span></span><br><span class="line">            <span class="keyword">if</span> (!overwriteExistingMipmaps &amp;&amp; faces.Any(f =&gt; f.Count &gt; <span class="number">1</span>))</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Generate the mips for each face.</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> face <span class="keyword">in</span> faces)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Remove any existing mipmaps.</span></span><br><span class="line">                <span class="keyword">var</span> faceBitmap = face[<span class="number">0</span>];</span><br><span class="line">                face.Clear();</span><br><span class="line">                face.Add(faceBitmap);</span><br><span class="line">                <span class="keyword">var</span> faceType = faceBitmap.GetType();</span><br><span class="line">                <span class="keyword">int</span> width = faceBitmap.Width;</span><br><span class="line">                <span class="keyword">int</span> height = faceBitmap.Height;</span><br><span class="line">                <span class="keyword">while</span> (width &gt; <span class="number">1</span> &amp;&amp; height &gt; <span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    width /= <span class="number">2</span>;</span><br><span class="line">                    height /= <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> mip = (BitmapContent)Activator.CreateInstance(faceType, <span class="keyword">new</span> <span class="keyword">object</span>[] &#123; width, height &#125;);</span><br><span class="line">                    BitmapContent.Copy(faceBitmap, mip);</span><br><span class="line">                    face.Add(mip);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> Verifies that all contents of this texture are present, correct and match the capabilities of the device.</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="targetProfile"&gt;</span>The profile identifier that defines the capabilities of the device.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Validate</span>(<span class="params">GraphicsProfile? targetProfile</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/编程/" rel="tag"># 编程</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/17/MonoGame笔记(十一)GameServices/" rel="next" title="MonoGame笔记(十一)GameService">
                <i class="fa fa-chevron-left"></i> MonoGame笔记(十一)GameService
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/20/MonoGame笔记(十三)扩展Content Pipeline/" rel="prev" title="MonoGame笔记(十三)扩展Content Pipeline">
                MonoGame笔记(十三)扩展Content Pipeline <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">zmapleaf</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">66</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Importer"><span class="nav-number">1.</span> <span class="nav-text">Importer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TextureProcessor"><span class="nav-number">2.</span> <span class="nav-text">TextureProcessor</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#序列化"><span class="nav-number">3.</span> <span class="nav-text">序列化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#反序列化"><span class="nav-number">4.</span> <span class="nav-text">反序列化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TextureContent"><span class="nav-number">5.</span> <span class="nav-text">TextureContent</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zmapleaf</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
